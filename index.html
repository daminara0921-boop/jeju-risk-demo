<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>ì œì£¼ ì—°ì•ˆ ìœ„í—˜ ì§€ë„</title>
  <style>
    :root{
      --bg:#f3f4f6;
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --line:#e5e7eb;

      --ok:#22c55e;     /* ë³´í†µ(ì´ˆë¡) */
      --warn:#a855f7;   /* ìš°ë ¤(ë³´ë¼) */
      --danger:#ef4444; /* ì‹¬ê°(ë¹¨ê°•) */

      --blue:#3b82f6;
      --red:#ef4444;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, Arial, sans-serif;
    }

    /* ìƒë‹¨ ì•ˆì „ ì˜ì—­(ì•„ì´í° ë…¸ì¹˜) */
    .safeTop{ height: env(safe-area-inset-top); background: var(--bg); }

    .page{
      max-width: 520px;
      margin: 0 auto;
      padding: 14px 14px calc(120px + env(safe-area-inset-bottom));
    }

    .title{
      font-size: 18px;
      font-weight: 900;
      letter-spacing: -0.2px;
      margin: 10px 0 8px;
    }

    .subtitle{
      font-size: 13px;
      color: var(--muted);
      line-height: 1.4;
      margin: 0 0 12px;
      font-weight: 700;
    }

    .card{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 18px;
      overflow: hidden;
      box-shadow: 0 8px 24px rgba(0,0,0,0.04);
    }

    /* ì§€ë„ ì˜ì—­: ìœ„/ì•„ë˜ ì—¬ë°± ì—†ì´ ê½‰ ì°¨ê²Œ */
    .mapWrap{
      position: relative;
      width:100%;
      background:#111827;
    }
    .mapImg{
      display:block;
      width:100%;
      height:auto;
    }

    /* ë²”ë¡€: ì˜¤ë¥¸ìª½ ì•„ë˜ */
    .legend{
      position:absolute;
      right: 12px;
      bottom: 12px;
      padding: 10px 10px;
      background: rgba(255,255,255,0.92);
      border: 1px solid rgba(229,231,235,0.9);
      border-radius: 14px;
      backdrop-filter: blur(6px);
      font-size: 11px;
      color:#111827;
      z-index: 5;
      min-width: 110px;
    }
    .legendRow{
      display:flex;
      align-items:center;
      gap:8px;
      margin: 6px 0;
      font-weight: 900;
    }
    .dot{
      width:10px;height:10px;border-radius:999px;
      border: 1px solid rgba(0,0,0,0.12);
    }

    .copy{
      padding: 12px 14px;
      border-top: 1px solid var(--line);
    }
    .copy strong{ font-weight: 900; }
    .copy p{
      margin:0;
      font-size: 13px;
      line-height: 1.45;
      color:#111827;
      font-weight: 800;
    }

    /* ê²€ìƒ‰/ì•¡ì…˜ */
    .panel{
      margin-top: 12px;
      padding: 12px 14px;
    }

    .searchRow{
      display:flex;
      gap:10px;
      align-items:center;
    }
    .searchRow input{
      flex:1;
      border:1px solid var(--line);
      border-radius: 14px;
      padding: 12px 12px;
      font-size: 14px;
      font-weight: 800;
      outline:none;
      background:#fff;
    }
    .iconBtn{
      width: 46px;
      height: 46px;
      border: 0;
      border-radius: 14px;
      background:#111827;
      color:#fff;
      font-size: 18px;
      font-weight: 900;
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
    }

    .actions{
      display:flex;
      gap:10px;
      margin-top: 12px;
    }
    .btn{
      flex:1;
      border: 0;
      border-radius: 16px;
      padding: 12px 12px;
      font-size: 14px;
      font-weight: 900;
      cursor:pointer;
    }
    .btnPrimary{ background:#111827; color:#fff; }
    .btnGhost{ background:#f3f4f6; color:#111827; border:1px solid var(--line); }

    .hintBox{
      margin-top: 12px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid #bfdbfe;
      background: #eff6ff;
      color:#1e3a8a;
      font-size: 12px;
      font-weight: 900;
      line-height: 1.35;
      display:none;
    }

    /* í˜‘ì¬ ê²€ìƒ‰ ê²°ê³¼(ìƒ˜í”Œ) */
    .sampleWrap{
      margin-top: 12px;
      display:none;
    }
    .sampleTitle{
      font-size: 13px;
      font-weight: 900;
      color:#111827;
      margin: 0 0 8px;
    }
    .sampleBody{
      position: relative;
      width:100%;
      aspect-ratio: 4 / 3;     /* âœ… 4:3 */
      background:#111827;
      border-radius: 16px;
      overflow:hidden;
      border:1px solid var(--line);
    }
    .sampleBody img{
      position:absolute; inset:0;
      width:100%; height:100%;
      object-fit: cover;       /* âœ… ì—¬ë°± ì—†ì´ ê½‰ */
    }

    .shotHint{
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      background: #fff7ed;
      border: 1px solid #fed7aa;
      color: #9a3412;
      font-size: 12px;
      font-weight: 900;
      line-height: 1.35;
    }

    /* ë¦¬ì›Œë“œ ë°”: í•˜ë‹¨ ê³ ì • */
    .rewardDock{
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      padding: 10px 12px calc(10px + env(safe-area-inset-bottom));
      background: rgba(243,244,246,0.92);
      backdrop-filter: blur(8px);
      border-top: 1px solid rgba(229,231,235,0.85);
      z-index: 50;
    }
    .rewardInner{
      max-width: 520px;
      margin: 0 auto;
      background:#fff;
      border: 1px solid var(--line);
      border-radius: 18px;
      padding: 12px 12px;
      display:flex;
      align-items:center;
      gap:12px;
      box-shadow: 0 10px 24px rgba(0,0,0,0.06);
    }
    .rewardLeft{
      min-width: 80px;
    }
    .rewardLabel{
      font-size: 11px;
      color: var(--muted);
      font-weight: 900;
      margin-bottom: 4px;
    }
    .rewardValue{
      font-size: 18px;
      font-weight: 1000;
      letter-spacing: -0.4px;
    }
    .bar{
      flex:1;
      height: 12px;
      background:#f3f4f6;
      border: 1px solid var(--line);
      border-radius: 999px;
      overflow:hidden;
      position: relative;
    }
    .barFill{
      height:100%;
      width: 0%;
      background: linear-gradient(90deg, #22c55e, #a855f7, #ef4444);
      border-radius: 999px;
      transition: width 240ms ease;
    }

    /* +10P íŒì—… */
    .toast{
      position: fixed;
      left: 50%;
      bottom: 110px;
      transform: translateX(-50%);
      z-index: 60;
      pointer-events: none;
      opacity: 0;
    }
    .toast.show{
      animation: popUp 900ms ease forwards;
    }
    .toastBubble{
      background: rgba(17,24,39,0.92);
      color:#fff;
      font-weight: 1000;
      font-size: 14px;
      padding: 10px 14px;
      border-radius: 999px;
      box-shadow: 0 16px 36px rgba(0,0,0,0.22);
    }
    @keyframes popUp{
      0%{ opacity:0; transform: translate(-50%, 14px) scale(0.96); }
      20%{ opacity:1; transform: translate(-50%, 0px) scale(1.02); }
      70%{ opacity:1; transform: translate(-50%, -26px) scale(1.0); }
      100%{ opacity:0; transform: translate(-50%, -44px) scale(0.98); }
    }

    /* AR ëª¨ë‹¬ */
    .modal{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      z-index: 100;
      display:none;
      align-items: flex-end;
      justify-content: center;
      padding: 12px;
    }
    .modal.show{ display:flex; }

    .sheet{
      width: min(520px, 100%);
      background:#fff;
      border-radius: 20px;
      overflow:hidden;
      border: 1px solid rgba(229,231,235,0.95);
      box-shadow: 0 24px 60px rgba(0,0,0,0.25);
    }
    .sheetHeader{
      padding: 12px 14px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      border-bottom: 1px solid var(--line);
    }
    .sheetTitle{
      font-size: 14px;
      font-weight: 1000;
    }
    .closeBtn{
      border:0;
      background:#f3f4f6;
      border:1px solid var(--line);
      border-radius: 12px;
      padding: 8px 10px;
      font-weight: 1000;
      cursor:pointer;
    }

    .arStage{
      position: relative;
      width:100%;
      aspect-ratio: 4 / 3;
      background:#111827;
      overflow:hidden;
    }
    video{
      position:absolute; inset:0;
      width:100%; height:100%;
      object-fit: cover;
    }

    /* ì˜ˆìƒ ìˆ˜ìœ„(ë¹¨ê°„ì„ ) */
    .waterLine{
      position:absolute;
      left:0; right:0;
      height: 4px;
      background: rgba(239,68,68,0.95);
      z-index: 6;
      box-shadow: 0 0 0 2px rgba(239,68,68,0.22);
    }
    .waterTag{
      position:absolute;
      right: 10px;
      transform: translateY(-50%);
      z-index: 7;
      background: rgba(239,68,68,0.92);
      color:#fff;
      font-size: 11px;
      font-weight: 1000;
      padding: 6px 10px;
      border-radius: 999px;
      box-shadow: 0 14px 30px rgba(0,0,0,0.2);
    }

    /* âœ… ê¸°ì¤€(ëŒë¶€ë¦¬) ë¼ì¸: ë„ˆê°€ ê·¸ë¦° â€˜ë‘¥ê¸€ê²Œ ë‚´ë ¤ì˜¤ë‹¤ êº¾ì—¬ì„œ ì­‰â€™ */
    .baseCurve{
      position: absolute;
      left: 10px;
      right: 10px;
      height: 70px;
      top: 78%;
      transform: translateY(-50%);
      z-index: 8;
      pointer-events: none;
    }
    .baseCurve path{
      fill:none;
      stroke: rgba(59,130,246,0.95);
      stroke-width: 14;
      stroke-linecap: round;
      stroke-linejoin: round;
      filter: drop-shadow(0 0 0 rgba(59,130,246,0.22));
    }

    .arNote{
      padding: 12px 14px;
      border-top: 1px solid var(--line);
    }
    .arNote .small{
      font-size: 12px;
      color:#111827;
      font-weight: 900;
      line-height: 1.35;
    }

    /* íŒŒì¼ input ìˆ¨ê¹€ */
    input[type="file"]{ display:none; }
  </style>
</head>

<body>
  <div class="safeTop"></div>

  <div class="page">
    <div class="title">ì œì£¼ ì—°ì•ˆ ìœ„í—˜ ì§€ë„</div>
    <div class="subtitle">
      ìš°ë¦¬ ëª¨ë‘ í•¨ê»˜ ë§Œë“œëŠ” ì•ˆì „ ëª¨ë‹ˆí„°ë§, ì‘ì€ í–‰ë™ì´ ì œì£¼ë„ë¥¼ ì§€í‚µë‹ˆë‹¤. í•¨ê»˜í•˜ê³  ë³´ìƒ ë°›ì•„ìš”!
    </div>

    <div class="card">
      <div class="mapWrap">
        <img class="mapImg" src="jeju-risk-map.png" alt="ì œì£¼ ìœ„í—˜ ì§€ë„" />

        <div class="legend">
          <div class="legendRow"><span class="dot" style="background:var(--ok)"></span>ë³´í†µ</div>
          <div class="legendRow"><span class="dot" style="background:var(--warn)"></span>ìš°ë ¤</div>
          <div class="legendRow"><span class="dot" style="background:var(--danger)"></span>ì‹¬ê°</div>
        </div>
      </div>

      <div class="copy">
        <p><strong>ìœ„í—˜ì€ ë³´ì´ì§€ ì•Šìœ¼ë©´ ë¬´ì‹œë©ë‹ˆë‹¤.</strong><br/>
          ì‚¬ì§„ ì œë³´ë¡œ ìœ„í—˜ì„ ë³´ì´ê²Œ ë§Œë“¤ê³ , ë³´ìƒì„ ë°›ì•„ìš”.</p>
      </div>
    </div>

    <div class="card panel" style="margin-top:12px;">
      <div class="searchRow">
        <input id="locInput" type="text" placeholder="í˜„ì¬ ìœ„ì¹˜ ì…ë ¥ (ì˜ˆ: í˜‘ì¬)" />
        <button id="searchBtn" class="iconBtn" aria-label="ê²€ìƒ‰">ğŸ”</button>
      </div>

      <div id="searchHint" class="hintBox"></div>

      <div id="sampleWrap" class="sampleWrap">
        <div class="sampleTitle">í˜‘ì¬ Â· ê¶Œì¥ êµ¬ë„ ìƒ˜í”Œ</div>
        <div class="sampleBody">
          <img src="sample-hyeopjae.jpg" alt="í˜‘ì¬ ìƒ˜í”Œ" />
        </div>
        <div class="shotHint">ğŸ“Œ <b>ëŒ ì¥ì‹ì´ í™”ë©´ ì™¼ìª½ ì•„ë˜</b>ì— ìœ„ì¹˜í•˜ë„ë¡ ì´¬ì˜í•´ì£¼ì„¸ìš”.</div>

        <div class="actions" style="margin-top:12px;">
          <button id="uploadBtn2" class="btn btnPrimary">ì‚¬ì§„ ì œë³´(ì—…ë¡œë“œ)</button>
          <button id="arOpenBtn2" class="btn btnGhost">AR ëª¨ë“œ ì‹œì‘</button>
        </div>

        <div class="actions" style="margin-top:10px;">
          <button id="btn5" class="btn btnGhost">5ë…„ ë’¤</button>
          <button id="btn10" class="btn btnGhost">10ë…„ ë’¤</button>
        </div>
      </div>

      <!-- ê¸°ë³¸ ì•¡ì…˜(í˜‘ì¬ ì•„ë‹ˆì–´ë„ ì‚¬ì§„ ì œë³´/AR ì ‘ê·¼ ê°€ëŠ¥í•˜ê²Œ) -->
      <div class="actions" style="margin-top:12px;">
        <button id="uploadBtn" class="btn btnPrimary">ì‚¬ì§„ ì œë³´(ì—…ë¡œë“œ)</button>
        <button id="arOpenBtn" class="btn btnGhost">AR ëª¨ë“œ ì‹œì‘</button>
      </div>

      <!-- ìˆ¨ê¹€ íŒŒì¼ input -->
      <input id="fileInput" type="file" accept="image/*" />
    </div>
  </div>

  <!-- í•˜ë‹¨ ë¦¬ì›Œë“œ ê³ ì • -->
  <div class="rewardDock">
    <div class="rewardInner">
      <div class="rewardLeft">
        <div class="rewardLabel">ë‚´ ë¦¬ì›Œë“œ</div>
        <div class="rewardValue"><span id="pointsText">0</span>P</div>
      </div>
      <div class="bar" aria-label="ë¦¬ì›Œë“œ ì§„í–‰ë„">
        <div id="barFill" class="barFill"></div>
      </div>
    </div>
  </div>

  <!-- +10P í† ìŠ¤íŠ¸ -->
  <div id="toast" class="toast" aria-hidden="true">
    <div class="toastBubble">+10P</div>
  </div>

  <!-- AR ëª¨ë‹¬ -->
  <div id="modal" class="modal" role="dialog" aria-modal="true">
    <div class="sheet">
      <div class="sheetHeader">
        <div class="sheetTitle" id="arTitle">AR ëª¨ë“œ Â· í˜‘ì¬</div>
        <button id="closeModal" class="closeBtn">ë‹«ê¸°</button>
      </div>

      <div class="arStage">
        <video id="cam" playsinline autoplay muted></video>

        <!-- ì˜ˆìƒ ìˆ˜ìœ„(ë¹¨ê°„ì„ ) -->
        <div id="waterLine" class="waterLine" style="top:70%;"></div>
        <div id="waterTag" class="waterTag" style="top:70%;">ì˜ˆìƒ ìˆ˜ìœ„</div>

        <!-- âœ… ê¸°ì¤€(ëŒë¶€ë¦¬) ë¼ì¸: ë„¤ ê·¸ë¦¼ ê·¸ëŒ€ë¡œ -->
        <svg id="baseCurve" class="baseCurve" viewBox="0 0 200 80" preserveAspectRatio="none" aria-hidden="true">
          <path d="M10,20 Q40,20 55,40 L70,60 L190,60"></path>
        </svg>
      </div>

      <div class="arNote">
        <div class="small">ğŸ“Œ <b>ê¸°ì¤€(ëŒë¶€ë¦¬)</b>ì— ë§ì¶° í™”ë©´ì„ ì •ë ¬í•œ ë’¤, ë¹¨ê°„ì„ (ì˜ˆìƒ ìˆ˜ìœ„)ì„ í™•ì¸í•˜ì„¸ìš”.</div>
        <div class="small" style="margin-top:6px;color:var(--muted);font-weight:800;">
          * ë°œí‘œìš© ì‹œì•ˆ: ìœ„ì¹˜(í˜‘ì¬)ì— ëŒ€í•´ ê³ ì • ì‹œë‚˜ë¦¬ì˜¤(5ë…„/10ë…„)ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
        </div>
      </div>
    </div>
  </div>

  <script>
    // =========================
    // ìƒíƒœ/ì €ì¥
    // =========================
    const STORAGE_KEY = "jeju_reward_points_v1";
    const pointsText = document.getElementById("pointsText");
    const barFill = document.getElementById("barFill");
    const toast = document.getElementById("toast");

    let points = Number(localStorage.getItem(STORAGE_KEY) || "0");
    renderPoints();

    function renderPoints(){
      pointsText.textContent = String(points);

      // ì§„í–‰ë„: 0~200Pë¥¼ 0~100%ë¡œ ê°€ì •(ì›í•˜ë©´ ë°”ê¿”ë„ ë¨)
      const pct = Math.max(0, Math.min(100, (points / 200) * 100));
      barFill.style.width = pct + "%";

      localStorage.setItem(STORAGE_KEY, String(points));
    }

    function showToast(){
      toast.classList.remove("show");
      // reflow to restart animation
      void toast.offsetWidth;
      toast.classList.add("show");
    }

    // =========================
    // ì—…ë¡œë“œ(ì‚¬ì§„ ì œë³´) â†’ +10P
    // =========================
    const fileInput = document.getElementById("fileInput");
    const uploadBtn = document.getElementById("uploadBtn");
    const uploadBtn2 = document.getElementById("uploadBtn2");

    function openUploader(){
      fileInput.value = "";
      fileInput.click();
    }
    uploadBtn.addEventListener("click", openUploader);
    if(uploadBtn2) uploadBtn2.addEventListener("click", openUploader);

    fileInput.addEventListener("change", () => {
      const f = fileInput.files && fileInput.files[0];
      if(!f) return;

      // ì‹¤ì œ ì—…ë¡œë“œëŠ” ìƒëµ(ì‹œì•ˆ). ì—…ë¡œë“œí–ˆë‹¤ê³  ê°€ì •í•˜ê³  í¬ì¸íŠ¸ ì§€ê¸‰.
      points += 10;
      renderPoints();
      showToast();
    });

    // =========================
    // í˜‘ì¬ ê²€ìƒ‰ â†’ ìƒ˜í”Œ í‘œì‹œ + ë¬¸êµ¬ í‘œì‹œ
    // =========================
    const locInput = document.getElementById("locInput");
    const searchBtn = document.getElementById("searchBtn");
    const sampleWrap = document.getElementById("sampleWrap");
    const searchHint = document.getElementById("searchHint");

    function doSearch(){
      const q = (locInput.value || "").trim();
      if(q === "í˜‘ì¬"){
        sampleWrap.style.display = "block";
        searchHint.style.display = "none";
      } else {
        sampleWrap.style.display = "none";
        searchHint.style.display = "block";
        searchHint.textContent = "ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. (ì‹œì•ˆ: â€˜í˜‘ì¬â€™ë§Œ ì œê³µ)";
      }
    }
    searchBtn.addEventListener("click", doSearch);
    locInput.addEventListener("keydown", (e) => { if(e.key === "Enter") doSearch(); });

    // =========================
    // AR ëª¨ë‹¬ + ì¹´ë©”ë¼
    // =========================
    const modal = document.getElementById("modal");
    const closeModal = document.getElementById("closeModal");
    const arOpenBtn = document.getElementById("arOpenBtn");
    const arOpenBtn2 = document.getElementById("arOpenBtn2");
    const cam = document.getElementById("cam");
    const waterLine = document.getElementById("waterLine");
    const waterTag = document.getElementById("waterTag");
    const arTitle = document.getElementById("arTitle");

    let stream = null;

    // âœ… ìš”ì²­ê°’: 5ë…„=0.5 / 10ë…„=0.7
    const LEVEL_5Y = 0.5;   // 50%
    const LEVEL_10Y = 0.7;  // 70%
    let currentLevel = LEVEL_10Y;

    function setWaterLevel(level){
      currentLevel = level;
      const topPct = Math.max(0, Math.min(1, level)) * 100;
      waterLine.style.top = topPct + "%";
      waterTag.style.top = topPct + "%";
      waterTag.textContent = (level === LEVEL_5Y) ? "ì˜ˆìƒ ìˆ˜ìœ„ Â· 5ë…„" : "ì˜ˆìƒ ìˆ˜ìœ„ Â· 10ë…„";
    }
    setWaterLevel(LEVEL_10Y);

    async function startCamera(){
      if(stream) return;
      try{
        stream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: "environment" },
          audio: false
        });
        cam.srcObject = stream;
        await cam.play();
      }catch(err){
        alert("ì¹´ë©”ë¼ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤. (iPhone: ì„¤ì • > Safari > ì¹´ë©”ë¼ í—ˆìš©)");
        console.error(err);
      }
    }

    function stopCamera(){
      if(!stream) return;
      stream.getTracks().forEach(t => t.stop());
      stream = null;
      cam.srcObject = null;
    }

    function openAR(){
      modal.classList.add("show");
      arTitle.textContent = "AR ëª¨ë“œ Â· í˜‘ì¬";
      startCamera();
    }

    function closeAR(){
      modal.classList.remove("show");
      stopCamera();
    }

    arOpenBtn.addEventListener("click", openAR);
    if(arOpenBtn2) arOpenBtn2.addEventListener("click", openAR);
    closeModal.addEventListener("click", closeAR);
    modal.addEventListener("click", (e)=>{ if(e.target === modal) closeAR(); });

    // 5ë…„/10ë…„ ë²„íŠ¼(í˜‘ì¬ ê²€ìƒ‰ ì‹œ í‘œì‹œ)
    const btn5 = document.getElementById("btn5");
    const btn10 = document.getElementById("btn10");

    if(btn5) btn5.addEventListener("click", () => setWaterLevel(LEVEL_5Y));
    if(btn10) btn10.addEventListener("click", () => setWaterLevel(LEVEL_10Y));
  </script>
</body>
</html>
