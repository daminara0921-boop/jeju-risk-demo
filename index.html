<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì œì£¼ ì—°ì•ˆ ìœ„í—˜ ì§€ë„</title>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f3f4f6;
      display: flex;
      justify-content: center;
      padding: 20px;
      padding-bottom: 130px; /* í•˜ë‹¨ ê³ ì • ë¦¬ì›Œë“œ ë°” ê³µê°„ */
    }

    .container {
      width: 100%;
      max-width: 420px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .card {
      background: white;
      border-radius: 18px;
      padding: 16px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.06);
    }

    h1 { margin: 0; font-size: 20px; font-weight: 800; }

    .desc {
      margin-top: 8px;
      margin-bottom: 0;
      font-size: 13px;
      color: #4b5563;
      line-height: 1.4;
    }

    /* ì§€ë„ */
    .mapBox {
      position: relative;
      width: 100%;
      aspect-ratio: 4 / 3;
      border-radius: 14px;
      overflow: hidden;
      background: #e5e7eb;
    }
    .mapBox img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    /* ë²”ë¡€: ì˜¤ë¥¸ìª½ ì•„ë˜ */
    .legend {
      position: absolute;
      right: 12px;
      bottom: 12px;
      border-radius: 14px;
      background: rgba(255,255,255,0.9);
      border: 1px solid #e5e7eb;
      padding: 8px 10px;
      font-size: 11px;
      color: #374151;
      backdrop-filter: blur(6px);
    }
    .legend b { display: block; margin-bottom: 4px; }

    /* +10P íŒì—… */
    .toast {
      position: fixed;
      left: 50%;
      top: 14%;
      transform: translateX(-50%);
      background: rgba(17,24,39,0.92);
      color: white;
      padding: 10px 14px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 900;
      box-shadow: 0 12px 30px rgba(0,0,0,0.25);
      border: 1px solid rgba(255,255,255,0.12);
      z-index: 99999;
      opacity: 0;
      pointer-events: none;
    }
    .toast.show { animation: pop 1.1s ease forwards; }
    @keyframes pop {
      0% { opacity: 0; transform: translateX(-50%) translateY(10px) scale(0.95); }
      15% { opacity: 1; transform: translateX(-50%) translateY(0px) scale(1.03); }
      55% { opacity: 1; transform: translateX(-50%) translateY(-6px) scale(1); }
      100% { opacity: 0; transform: translateX(-50%) translateY(-18px) scale(0.98); }
    }

    /* ë²„íŠ¼ */
    .btn {
      width: 100%;
      border-radius: 14px;
      padding: 14px 12px;
      font-weight: 800;
      font-size: 14px;
      cursor: pointer;
    }
    .btnBlack { background: black; color: white; border: none; }
    .btnWhite { background: white; border: 1px solid #e5e7eb; }

    /* íŒ¨ë„ */
    .panel {
      display: none;
      margin-top: 12px;
      padding: 14px;
      border-radius: 14px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
    }
    .panelTitle { font-size: 14px; font-weight: 900; margin: 0 0 8px 0; color: #111827; }
    .guide { font-size: 12px; color: #4b5563; margin: 0 0 12px 0; line-height: 1.4; }
    .hint { font-size: 12px; color: #6b7280; margin: 8px 0 0 0; }

    .fileBox { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
    input[type="file"] { font-size: 12px; }

    .uploadBtn {
      padding: 10px 12px;
      border-radius: 12px;
      border: none;
      background: #111827;
      color: white;
      font-weight: 900;
      cursor: pointer;
      font-size: 12px;
    }

    .status {
      margin-top: 10px;
      font-size: 12px;
      color: #111827;
      font-weight: 800;
      line-height: 1.4;
      display: none;
    }
    .status small {
      display: block;
      color: #6b7280;
      font-weight: 400;
      margin-top: 2px;
    }

    /* ê²€ìƒ‰ UI */
    .searchRow {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    .searchRow input {
      flex: 1;
      min-width: 180px;
      padding: 11px 12px;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      background: white;
      font-size: 13px;
      outline: none;
    }
    .searchBtn {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      border: none;
      background: #111827;
      color: white;
      font-size: 18px;
      font-weight: 900;
      cursor: pointer;
      display: grid;
      place-items: center;
    }

    /* ìƒ˜í”Œ ì´ë¯¸ì§€ */
    .sampleWrap {
      display: none;
      margin-top: 12px;
      border-radius: 14px;
      overflow: hidden;
      border: 1px solid #e5e7eb;
      background: #111827;
    }
    .sampleHeader {
      padding: 10px 12px;
      background: white;
      border-bottom: 1px solid #e5e7eb;
      font-size: 12px;
      font-weight: 900;
      color: #111827;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .badge {
      font-size: 11px;
      font-weight: 900;
      color: white;
      background: #111827;
      padding: 6px 10px;
      border-radius: 999px;
    }

    .sampleBody {
      position: relative;
      width: 100%;
      aspect-ratio: 4 / 3;
      background: #111827;
    }
    .sampleBody img {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    .sampleFallback {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      color: rgba(255,255,255,0.85);
      font-size: 12px;
      padding: 16px;
      text-align: center;
      line-height: 1.4;
    }

    /* âœ… í˜‘ì¬ ê²€ìƒ‰ì‹œì—ë§Œ ë³´ì´ëŠ” ì´¬ì˜ ê¸°ì¤€ ë¬¸êµ¬ */
    .shotHint{
      display: none;
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      background: #fff7ed;
      border: 1px solid #fed7aa;
      color: #9a3412;
      font-size: 12px;
      font-weight: 800;
      line-height: 1.35;
    }
    .shotHint b{ font-weight: 900; }

    /* ì˜ˆì¸¡ */
    .predictBox {
      display: none;
      gap: 8px;
      margin-top: 12px;
      flex-wrap: wrap;
    }
    .pill {
      padding: 8px 10px;
      border-radius: 999px;
      font-size: 12px;
      border: 1px solid #e5e7eb;
      background: white;
      cursor: pointer;
      font-weight: 900;
    }
    .pill.active { background: #111827; color: white; border-color: #111827; }

    .predictText {
      display: none;
      margin-top: 10px;
      font-size: 12px;
      color: #374151;
      line-height: 1.45;
    }

    /* AR */
    .arControls { display: none; margin-top: 12px; gap: 10px; flex-wrap: wrap; }
    .arWrap {
      display: none;
      margin-top: 12px;
      border-radius: 14px;
      overflow: hidden;
      border: 1px solid #e5e7eb;
      background: #111827;
    }
    .arFrame {
      position: relative;
      width: 100%;
      height: min(72vh, 640px);
      background: #111827;
    }
    .arFrame video {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      background: #111827;
    }
    .arHUD {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(17,24,39,0.55);
      color: white;
      padding: 8px 10px;
      border-radius: 12px;
      font-size: 12px;
      line-height: 1.35;
      border: 1px solid rgba(255,255,255,0.15);
      z-index: 10;
    }
    .waterLabel {
      position: absolute;
      right: 10px;
      transform: translateY(-50%);
      background: rgba(239,68,68,0.92);
      color: white;
      padding: 6px 8px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 900;
      border: 1px solid rgba(255,255,255,0.2);
      z-index: 11;
      white-space: nowrap;
    }

    /* âœ… ë„¤ ê·¸ë¦¼ ê°™ì€ â€˜ã„´ì+ë¼ìš´ë“œâ€™ ê¸°ì¤€ ë¼ì¸ */
    .baseCurve{
      position: absolute;
      left: 10px;
      right: 10px;
      height: 70px;
      top: 78%;
      transform: translateY(-50%);
      z-index: 9;
      pointer-events: none;
    }
    .baseCurve path{
      fill: none;
      stroke: rgba(59,130,246,0.95);
      stroke-width: 14;
      stroke-linecap: round;
      stroke-linejoin: round;
    }

    .baseNote {
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      background: #eff6ff;
      border: 1px solid #bfdbfe;
      color: #1e3a8a;
      font-size: 12px;
      font-weight: 900;
      line-height: 1.35;
    }

    /* í•˜ë‹¨ ê³ ì • ë¦¬ì›Œë“œ */
    .rewardDock {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      padding: 10px 12px;
      z-index: 9999;
    }
    .dockInner {
      max-width: 420px;
      margin: 0 auto;
      background: rgba(255,255,255,0.96);
      border: 1px solid #e5e7eb;
      border-radius: 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.12);
      padding: 12px 14px;
      backdrop-filter: blur(8px);
    }
    .dockTop { display: flex; justify-content: space-between; align-items: center; }
    .dockTitle { font-size: 13px; font-weight: 900; color: #111827; }
    .dockPoint { font-size: 13px; font-weight: 900; color: #111827; }
    .dockBarTrack {
      margin-top: 8px;
      width: 100%;
      height: 12px;
      background: #e5e7eb;
      border-radius: 999px;
      overflow: hidden;
    }
    .dockBarFill {
      height: 100%;
      width: 0%;
      background: #111827;
      border-radius: 999px;
      transition: width 0.35s ease;
    }
    .dockBottom {
      margin-top: 8px;
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: #4b5563;
    }
    .dockBottom b { color: #111827; }

    .locLabel {
      display: none;
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      background: white;
      border: 1px solid #e5e7eb;
      font-size: 12px;
      color: #111827;
      font-weight: 900;
      justify-content: space-between;
      align-items: center;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="card">
      <h1>ì œì£¼ ì—°ì•ˆ ìœ„í—˜ ì§€ë„</h1>
      <p class="desc">
        <b>ìš°ë¦¬ ëª¨ë‘ í•¨ê»˜ ë§Œë“œëŠ” ì•ˆì „ ëª¨ë‹ˆí„°ë§</b><br />
        ì‘ì€ í–‰ë™ì´ ì œì£¼ë„ë¥¼ ì§€í‚µë‹ˆë‹¤. í•¨ê»˜í•˜ê³  ë³´ìƒ ë°›ì•„ìš”!
      </p>
    </div>

    <div class="card">
      <div class="mapBox">
        <img src="jeju-risk-map.png" alt="Jeju Risk Map" />
        <div class="legend">
          <b>ìœ„í—˜ ë“±ê¸‰</b>
          ğŸŸ¢ ë³´í†µ&nbsp;&nbsp; ğŸŸ£ ìš°ë ¤&nbsp;&nbsp; ğŸ”´ ì‹¬ê°
        </div>
      </div>
    </div>

    <div class="card">
      <button id="btnUpload" class="btn btnBlack">ğŸ“¸ ì‚¬ì§„ ì œë³´í•˜ê¸°</button>

      <div id="uploadPanel" class="panel">
        <p class="panelTitle">ì‚¬ì§„ ì œë³´</p>
        <p class="guide">
          ë¨¼ì € <b>í˜„ì¬ ìœ„ì¹˜</b>ë¥¼ ì…ë ¥í•˜ê³  ë‹ë³´ê¸°ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.<br />
          ê·¸ëŸ¬ë©´ ê¶Œì¥ ì´¬ì˜ ê°ë„ ìƒ˜í”Œì„ ë³´ì—¬ì¤„ê²Œìš”.
        </p>

        <div class="searchRow">
          <input id="uploadLocInput" placeholder="í˜„ì¬ ìœ„ì¹˜ ì…ë ¥ (ì˜ˆ: í˜‘ì¬)" />
          <button id="uploadLocSearch" class="searchBtn" title="ê²€ìƒ‰">ğŸ”</button>
        </div>

        <div id="uploadLocStatus" class="status"></div>

        <div id="sampleWrap" class="sampleWrap">
          <div class="sampleHeader">
            <span>ê¶Œì¥ ì´¬ì˜ ê°ë„ ìƒ˜í”Œ</span>
            <span class="badge">í˜‘ì¬(ì‹œì•ˆ)</span>
          </div>

          <div class="sampleBody">
            <img id="sampleImg" src="sample-hyeopjae.jpg" alt="ìƒ˜í”Œ ì‚¬ì§„" />
            <div id="sampleFallback" class="sampleFallback">
              ìƒ˜í”Œ ì‚¬ì§„ íŒŒì¼ì„ ì•„ì§ ë„£ì§€ ì•Šì•˜ì–´ìš”.<br/><br/>
              í´ë”ì— <b>sample-hyeopjae.jpg</b>ë¥¼ ë„£ìœ¼ë©´<br/>
              ì´ ì˜ì—­ì— ìë™ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.
            </div>
          </div>
        </div>

        <div id="shotHint" class="shotHint">
          ğŸ“Œ <b>ëŒ ì¥ì‹ì´ í™”ë©´ ì™¼ìª½ ì•„ë˜</b>ì— ìœ„ì¹˜í•˜ë„ë¡ ì´¬ì˜í•´ì£¼ì„¸ìš”.
        </div>

        <p class="guide" style="margin-top:12px;">
          ìƒ˜í”Œì„ í™•ì¸í•œ ë’¤, ì‚¬ì§„ì„ ì„ íƒí•˜ê³  ì—…ë¡œë“œí•˜ë©´ <b>+10P</b>ê°€ ì ë¦½ë©ë‹ˆë‹¤.
        </p>

        <div class="fileBox">
          <input id="fileInput" type="file" accept="image/*" />
          <button id="submitUpload" class="uploadBtn">ì—…ë¡œë“œ(+10P)</button>
        </div>

        <div id="uploadStatus" class="status"></div>
      </div>

      <div style="height:10px;"></div>

      <button id="btnPredict" class="btn btnWhite">ğŸ”® ë¯¸ë˜ ì˜ˆì¸¡ ë³´ê¸° (AR)</button>

      <div id="predictPanel" class="panel">
        <p class="panelTitle">ë¯¸ë˜ ì˜ˆì¸¡(AR ì‹œì•ˆ)</p>
        <p class="guide">
          í˜„ì¬ ìœ„ì¹˜ë¥¼ ì…ë ¥í•˜ê³  ë‹ë³´ê¸°ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.<br />
          (ì§€ê¸ˆì€ <b>í˜‘ì¬</b>ë§Œ ì‹œì•ˆìœ¼ë¡œ ì—°ê²°ë˜ì–´ ìˆì–´ìš”)
        </p>

        <div class="searchRow">
          <input id="predictLocInput" placeholder="í˜„ì¬ ìœ„ì¹˜ ì…ë ¥ (ì˜ˆ: í˜‘ì¬)" />
          <button id="predictLocSearch" class="searchBtn" title="ê²€ìƒ‰">ğŸ”</button>
        </div>

        <div id="predictLocStatus" class="status"></div>

        <div id="locLabel" class="locLabel">
          <span>í˜„ì¬ ìœ„ì¹˜: <b id="locName">í˜‘ì¬</b> (ì‹œì•ˆ)</span>
          <span class="badge">ON</span>
        </div>

        <div id="predictBox" class="predictBox">
          <button id="p5" class="pill active">5ë…„ ë’¤</button>
          <button id="p10" class="pill">10ë…„ ë’¤</button>
        </div>

        <div id="predictText" class="predictText"></div>

        <div id="arControls" class="arControls">
          <button id="startAR" class="uploadBtn">ğŸ“· AR ëª¨ë“œ ì‹œì‘</button>
          <button id="stopAR" class="ghostBtn" style="display:none;">ì¢…ë£Œ</button>
        </div>

        <div id="arStage" class="arWrap">
          <div class="arFrame">
            <video id="arVideo" autoplay playsinline></video>

            <!-- ë¹¨ê°„ ì˜ˆìƒ ìˆ˜ìœ„ì„  -->
            <div id="waterLine" style="
              position:absolute; left:0; right:0;
              height:3px; background:#ef4444;
              top:62%;
              box-shadow: 0 0 0 2px rgba(239,68,68,0.25);
              z-index: 6;
            "></div>

            <div id="waterFill" style="
              position:absolute; left:0; right:0; bottom:0;
              top:62%;
              background: rgba(239,68,68,0.25);
              z-index: 5;
            "></div>

            <!-- âœ… íŒŒë€ ê¸°ì¤€ ë¼ì¸ -->
            <svg id="baseCurve" class="baseCurve" viewBox="0 0 200 80" preserveAspectRatio="none" aria-hidden="true">
              <path d="M10,20
                       Q40,20 55,40
                       L70,60
                       L190,60" />
            </svg>

            <div class="arHUD">
              <b>í˜‘ì¬ AR ì‹œì•ˆ</b><br/>
              ë¹¨ê°„ ì„  = ì˜ˆìƒ ìˆ˜ìœ„<br/>
              íŒŒë€ ì„  = ê¸°ì¤€(ëŒë¶€ë¦¬)
            </div>

            <div id="waterLabel" class="waterLabel" style="top:62%;">ì˜ˆìƒ ìˆ˜ìœ„ 0.5m</div>
          </div>

          <div class="baseNote">
            ğŸ“Œ <b>ëŒë¶€ë¦¬ì— ë§ì¶°</b> ì¸¡ì • ë¶€íƒë“œë¦½ë‹ˆë‹¤.
          </div>
        </div>

        <p class="hint">* ë°ëª¨ ë²„ì „: ìˆ˜ì¹˜/ë²”ìœ„ëŠ” ë°œí‘œìš© ì‹œë‚˜ë¦¬ì˜¤ ê°’ì…ë‹ˆë‹¤.</p>
      </div>

      <p class="hint">* ì‹¤ë‚´ QR ì‹œì—°ìš©: ì¹´ë©”ë¼ í™”ë©´ ìœ„ì— ìˆ˜ìœ„ ì˜¤ë²„ë ˆì´ë¡œ í‘œí˜„ë©ë‹ˆë‹¤.</p>
    </div>
  </div>

  <div id="toast" class="toast">+10P</div>

  <div class="rewardDock">
    <div class="dockInner">
      <div class="dockTop">
        <div class="dockTitle">âš¡ ë‚´ ë¦¬ì›Œë“œ</div>
        <div class="dockPoint"><span id="mePointDock">0</span>P</div>
      </div>

      <div class="dockBarTrack">
        <div id="barFillDock" class="dockBarFill"></div>
      </div>

      <div class="dockBottom">
        <span>ë‹¤ìŒ ë¦¬ì›Œë“œê¹Œì§€ <b id="toNextDock">100</b>P</span>
        <span>ì—…ë¡œë“œ <b id="uploadCountDock">0</b>íšŒ</span>
      </div>
    </div>
  </div>

  <script>
    // ====== ë¦¬ì›Œë“œ ======
    const MAX_POINT = 100;
    const savedPoint = Number(localStorage.getItem("myPoint") || "0");
    const savedCount = Number(localStorage.getItem("myUploadCount") || "0");

    let myPoint = savedPoint;
    let uploadCount = savedCount;

    const toast = document.getElementById("toast");
    const mePointDock = document.getElementById("mePointDock");
    const uploadCountDock = document.getElementById("uploadCountDock");
    const toNextDock = document.getElementById("toNextDock");
    const barFillDock = document.getElementById("barFillDock");

    function showToast(text) {
      toast.textContent = text;
      toast.classList.remove("show");
      void toast.offsetWidth;
      toast.classList.add("show");
    }

    function updateRewardUI() {
      const percent = Math.min(100, (myPoint / MAX_POINT) * 100);
      const left = Math.max(0, MAX_POINT - myPoint);

      mePointDock.textContent = myPoint;
      uploadCountDock.textContent = uploadCount;
      toNextDock.textContent = left;
      barFillDock.style.width = percent + "%";

      localStorage.setItem("myPoint", String(myPoint));
      localStorage.setItem("myUploadCount", String(uploadCount));
    }

    function addPoint(amount) {
      myPoint = Math.min(MAX_POINT, myPoint + amount);
      uploadCount += 1;
      updateRewardUI();
      showToast(`+${amount}P`);
    }

    updateRewardUI();

    // ====== íŒ¨ë„ í† ê¸€ ======
    const btnUpload = document.getElementById("btnUpload");
    const btnPredict = document.getElementById("btnPredict");
    const uploadPanel = document.getElementById("uploadPanel");
    const predictPanel = document.getElementById("predictPanel");

    function togglePanel(panel) {
      if (panel === uploadPanel) predictPanel.style.display = "none";
      if (panel === predictPanel) uploadPanel.style.display = "none";
      panel.style.display = panel.style.display === "block" ? "none" : "block";
    }
    btnUpload.addEventListener("click", () => togglePanel(uploadPanel));
    btnPredict.addEventListener("click", () => togglePanel(predictPanel));

    // ====== í˜‘ì¬ ë§¤ì¹­ ======
    function normalize(s) { return (s || "").trim().replace(/\s+/g, ""); }
    function isHyeopjae(input) { return normalize(input).includes("í˜‘ì¬"); }

    function showStatus(el, message, sub) {
      el.style.display = "block";
      el.innerHTML = `${message}<small>${sub || ""}</small>`;
    }

    // ====== ì—…ë¡œë“œ: ìœ„ì¹˜ ê²€ìƒ‰ + ìƒ˜í”Œ ======
    const uploadLocInput = document.getElementById("uploadLocInput");
    const uploadLocSearch = document.getElementById("uploadLocSearch");
    const uploadLocStatus = document.getElementById("uploadLocStatus");

    const sampleWrap = document.getElementById("sampleWrap");
    const sampleImg = document.getElementById("sampleImg");
    const sampleFallback = document.getElementById("sampleFallback");
    const shotHint = document.getElementById("shotHint");

    sampleImg.onerror = () => {
      sampleFallback.style.display = "grid";
      sampleImg.style.display = "none";
    };
    sampleImg.onload = () => {
      sampleFallback.style.display = "none";
      sampleImg.style.display = "block";
    };

    uploadLocSearch.addEventListener("click", () => {
      const v = uploadLocInput.value;

      if (!v.trim()) {
        showStatus(uploadLocStatus, "âš ï¸ ìœ„ì¹˜ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.", "ì˜ˆ: í˜‘ì¬");
        sampleWrap.style.display = "none";
        shotHint.style.display = "none";
        return;
      }

      if (isHyeopjae(v)) {
        showStatus(uploadLocStatus, "âœ… ìœ„ì¹˜ í™•ì¸: í˜‘ì¬(ì‹œì•ˆ)", "ê¶Œì¥ ì´¬ì˜ ê°ë„ ìƒ˜í”Œì„ í‘œì‹œí•©ë‹ˆë‹¤.");
        sampleWrap.style.display = "block";
        shotHint.style.display = "block";
        sampleImg.src = "sample-hyeopjae.jpg";
      } else {
        showStatus(uploadLocStatus, "âš ï¸ í˜„ì¬ëŠ” â€˜í˜‘ì¬â€™ë§Œ ì‹œì•ˆ ì§€ì› ì¤‘ì…ë‹ˆë‹¤.", "í˜‘ì¬ë¡œ ì…ë ¥í•´ í…ŒìŠ¤íŠ¸í•´ ì£¼ì„¸ìš”.");
        sampleWrap.style.display = "none";
        shotHint.style.display = "none";
      }
    });

    // ====== ì—…ë¡œë“œ(ë°ëª¨) ======
    const fileInput = document.getElementById("fileInput");
    const submitUpload = document.getElementById("submitUpload");
    const uploadStatus = document.getElementById("uploadStatus");

    submitUpload.addEventListener("click", () => {
      const file = fileInput.files && fileInput.files[0];

      if (!file) {
        showStatus(uploadStatus, "âš ï¸ ì‚¬ì§„ íŒŒì¼ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.", "íŒŒì¼ ì„ íƒ í›„ ì—…ë¡œë“œ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.");
        return;
      }

      showStatus(uploadStatus, "â³ ì—…ë¡œë“œ ì¤‘...", "ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.");
      setTimeout(() => {
        addPoint(10);
        showStatus(uploadStatus, "âœ… ì—…ë¡œë“œ ì™„ë£Œ! +10P ì§€ê¸‰", "ì œë³´ê°€ ë°˜ì˜ë˜ì—ˆìŠµë‹ˆë‹¤(ë°ëª¨).");
        fileInput.value = "";
      }, 900);
    });

    // ====== ì˜ˆì¸¡(AR): ìœ„ì¹˜ ê²€ìƒ‰ í›„ ê¸°ëŠ¥ ì—´ê¸° ======
    const predictLocInput = document.getElementById("predictLocInput");
    const predictLocSearch = document.getElementById("predictLocSearch");
    const predictLocStatus = document.getElementById("predictLocStatus");

    const locLabel = document.getElementById("locLabel");
    const locName = document.getElementById("locName");

    const predictBox = document.getElementById("predictBox");
    const predictText = document.getElementById("predictText");

    const arControls = document.getElementById("arControls");
    const startARBtn = document.getElementById("startAR");
    const stopARBtn = document.getElementById("stopAR");

    const arStage = document.getElementById("arStage");
    const arVideo = document.getElementById("arVideo");
    const waterLine = document.getElementById("waterLine");
    const waterFill = document.getElementById("waterFill");
    const waterLabel = document.getElementById("waterLabel");

    // âœ… ìš”ì²­ ë°˜ì˜: 5ë…„ 0.5m / 10ë…„ 0.7m
    const scenarios = {
      y5:  { meter: 0.5, percent: 62, text: "âœ… 5ë…„ ë’¤(í˜‘ì¬): ì¼ë¶€ êµ¬ê°„ ì¹¨ìˆ˜ ê°€ëŠ¥ì„± ì¦ê°€\nì˜ˆìƒ ìˆ˜ìœ„: 0.5m" },
      y10: { meter: 0.7, percent: 45, text: "âš ï¸ 10ë…„ ë’¤(í˜‘ì¬): ì¹¨ìˆ˜ ë²”ìœ„ í™•ëŒ€ ê°€ëŠ¥ì„±\nì˜ˆìƒ ìˆ˜ìœ„: 0.7m" }
    };

    let currentScenarioKey = "y5";
    let arStream = null;

    const p5 = document.getElementById("p5");
    const p10 = document.getElementById("p10");

    function applyScenario(key) {
      currentScenarioKey = key;
      const s = scenarios[key];

      predictText.innerHTML = s.text.replaceAll("\n", "<br/>");
      predictText.style.display = "block";

      waterLine.style.top = s.percent + "%";
      waterFill.style.top = s.percent + "%";
      waterLabel.style.top = s.percent + "%";
      waterLabel.textContent = `ì˜ˆìƒ ìˆ˜ìœ„ ${s.meter}m`;
    }

    p5.addEventListener("click", () => {
      p5.classList.add("active");
      p10.classList.remove("active");
      applyScenario("y5");
    });

    p10.addEventListener("click", () => {
      p10.classList.add("active");
      p5.classList.remove("active");
      applyScenario("y10");
    });

    function stopAR() {
      if (arStream) {
        arStream.getTracks().forEach(t => t.stop());
        arStream = null;
      }
      arStage.style.display = "none";
      stopARBtn.style.display = "none";
      startARBtn.style.display = "inline-block";
    }

    predictLocSearch.addEventListener("click", () => {
      const v = predictLocInput.value;
      if (!v.trim()) {
        showStatus(predictLocStatus, "âš ï¸ ìœ„ì¹˜ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.", "ì˜ˆ: í˜‘ì¬");
        return;
      }

      if (isHyeopjae(v)) {
        showStatus(predictLocStatus, "âœ… ìœ„ì¹˜ í™•ì¸: í˜‘ì¬(ì‹œì•ˆ)", "5ë…„/10ë…„ ë° AR ê¸°ëŠ¥ì„ í™œì„±í™”í•©ë‹ˆë‹¤.");

        locLabel.style.display = "flex";
        locName.textContent = "í˜‘ì¬";

        predictBox.style.display = "flex";
        arControls.style.display = "flex";

        p5.classList.add("active");
        p10.classList.remove("active");
        applyScenario("y5");
      } else {
        showStatus(predictLocStatus, "âš ï¸ í˜„ì¬ëŠ” â€˜í˜‘ì¬â€™ë§Œ ì‹œì•ˆ ì§€ì› ì¤‘ì…ë‹ˆë‹¤.", "í˜‘ì¬ë¡œ ì…ë ¥í•´ í…ŒìŠ¤íŠ¸í•´ ì£¼ì„¸ìš”.");

        locLabel.style.display = "none";
        predictBox.style.display = "none";
        predictText.style.display = "none";
        arControls.style.display = "none";
        stopAR();
      }
    });

    async function startAR() {
      try {
        arStream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: "environment" },
          audio: false
        });

        arVideo.srcObject = arStream;
        arStage.style.display = "block";
        stopARBtn.style.display = "inline-block";
        startARBtn.style.display = "none";

        applyScenario(currentScenarioKey);
      } catch (e) {
        alert("ì¹´ë©”ë¼ ê¶Œí•œì´ í•„ìš”í•´ìš”. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ì¹´ë©”ë¼ í—ˆìš© í›„ ë‹¤ì‹œ ì‹œë„í•´ì¤˜!");
      }
    }

    startARBtn.addEventListener("click", startAR);
    stopARBtn.addEventListener("click", stopAR);
    window.addEventListener("beforeunload", () => stopAR());
  </script>
</body>
</html>
