<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì œì£¼ ì—°ì•ˆ ìœ„í—˜ ì§€ë„</title>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f3f4f6;
      display: flex;
      justify-content: center;
      padding: 20px;
      padding-bottom: 130px; /* í•˜ë‹¨ ê³ ì • ë¦¬ì›Œë“œ ë°” ê³µê°„ */
    }

    .container {
      width: 100%;
      max-width: 420px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .card {
      background: white;
      border-radius: 18px;
      padding: 16px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.06);
    }

    h1 { margin: 0; font-size: 20px; font-weight: 800; }

    .desc {
      margin-top: 8px;
      margin-bottom: 0;
      font-size: 13px;
      color: #4b5563;
      line-height: 1.4;
    }

    /* ===== ì§€ë„ ===== */
    .mapBox {
      position: relative;
      width: 100%;
      aspect-ratio: 4 / 3;
      border-radius: 14px;
      overflow: hidden;
      background: #e5e7eb;
    }
    .mapBox img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    /* ë²”ë¡€: ì˜¤ë¥¸ìª½ ì•„ë˜ */
    .legend {
      position: absolute;
      right: 12px;
      bottom: 12px;
      border-radius: 14px;
      background: rgba(255,255,255,0.9);
      border: 1px solid #e5e7eb;
      padding: 8px 10px;
      font-size: 11px;
      color: #374151;
      backdrop-filter: blur(6px);
    }
    .legend b { display: block; margin-bottom: 4px; }

    /* +10P íŒì—… */
    .toast {
      position: fixed;
      left: 50%;
      top: 14%;
      transform: translateX(-50%);
      background: rgba(17,24,39,0.92);
      color: white;
      padding: 10px 14px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 900;
      box-shadow: 0 12px 30px rgba(0,0,0,0.25);
      border: 1px solid rgba(255,255,255,0.12);
      z-index: 99999;
      opacity: 0;
      pointer-events: none;
    }
    .toast.show { animation: pop 1.1s ease forwards; }
    @keyframes pop {
      0% { opacity: 0; transform: translateX(-50%) translateY(10px) scale(0.95); }
      15% { opacity: 1; transform: translateX(-50%) translateY(0px) scale(1.03); }
      55% { opacity: 1; transform: translateX(-50%) translateY(-6px) scale(1); }
      100% { opacity: 0; transform: translateX(-50%) translateY(-18px) scale(0.98); }
    }

    /* ë²„íŠ¼ */
    .btn {
      width: 100%;
      border-radius: 14px;
      padding: 14px 12px;
      font-weight: 800;
      font-size: 14px;
      cursor: pointer;
    }
    .btnBlack { background: black; color: white; border: none; }
    .btnWhite { background: white; border: 1px solid #e5e7eb; }

    /* íŒ¨ë„ */
    .panel {
      display: none;
      margin-top: 12px;
      padding: 14px;
      border-radius: 14px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
    }
    .panelTitle { font-size: 14px; font-weight: 900; margin: 0 0 8px 0; color: #111827; }
    .guide { font-size: 12px; color: #4b5563; margin: 0 0 12px 0; line-height: 1.4; }
    .hint { font-size: 12px; color: #6b7280; margin: 8px 0 0 0; }

    .uploadBtn {
      padding: 10px 12px;
      border-radius: 12px;
      border: none;
      background: #111827;
      color: white;
      font-weight: 900;
      cursor: pointer;
      font-size: 12px;
    }
    .ghostBtn {
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      background: white;
      font-weight: 900;
      cursor: pointer;
      font-size: 12px;
    }

    .status {
      margin-top: 10px;
      font-size: 12px;
      color: #111827;
      font-weight: 800;
      line-height: 1.4;
      display: none;
    }
    .status small {
      display: block;
      color: #6b7280;
      font-weight: 400;
      margin-top: 2px;
    }

    /* ê²€ìƒ‰ UI */
    .searchRow {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    .searchRow input {
      flex: 1;
      min-width: 180px;
      padding: 11px 12px;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      background: white;
      font-size: 13px;
      outline: none;
    }
    .searchBtn {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      border: none;
      background: #111827;
      color: white;
      font-size: 18px;
      font-weight: 900;
      cursor: pointer;
      display: grid;
      place-items: center;
    }

    /* ìƒ˜í”Œ ì´ë¯¸ì§€ */
    .sampleWrap {
      display: none;
      margin-top: 12px;
      border-radius: 14px;
      overflow: hidden;
      border: 1px solid #e5e7eb;
      background: #111827;
    }
    .sampleHeader {
      padding: 10px 12px;
      background: white;
      border-bottom: 1px solid #e5e7eb;
      font-size: 12px;
      font-weight: 900;
      color: #111827;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .badge {
      font-size: 11px;
      font-weight: 900;
      color: white;
      background: #111827;
      padding: 6px 10px;
      border-radius: 999px;
    }

    .sampleBody {
      position: relative;
      width: 100%;
      aspect-ratio: 4 / 3;
      background: #111827;
    }
    .sampleBody img {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    .sampleFallback {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      color: rgba(255,255,255,0.85);
      font-size: 12px;
      padding: 16px;
      text-align: center;
      line-height: 1.4;
    }

    /* í˜‘ì¬ ê²€ìƒ‰ì‹œì—ë§Œ ë³´ì´ëŠ” ì´¬ì˜ ê¸°ì¤€ ë¬¸êµ¬ */
    .shotHint{
      display: none;
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      background: #fff7ed;
      border: 1px solid #fed7aa;
      color: #9a3412;
      font-size: 12px;
      font-weight: 800;
      line-height: 1.35;
    }
    .shotHint b{ font-weight: 900; }

    /* ì˜ˆì¸¡ */
    .predictBox {
      display: none;
      gap: 8px;
      margin-top: 12px;
      flex-wrap: wrap;
    }
    .pill {
      padding: 8px 10px;
      border-radius: 999px;
      font-size: 12px;
      border: 1px solid #e5e7eb;
      background: white;
      cursor: pointer;
      font-weight: 900;
    }
    .pill.active { background: #111827; color: white; border-color: #111827; }

    .predictText {
      display: none;
      margin-top: 10px;
      font-size: 12px;
      color: #374151;
      line-height: 1.45;
      white-space: pre-line;
    }

    /* AR */
    .arControls { display: none; margin-top: 12px; gap: 10px; flex-wrap: wrap; }
    .arWrap {
      display: none;
      margin-top: 12px;
      border-radius: 14px;
      overflow: hidden;
      border: 1px solid #e5e7eb;
      background: #111827;
    }
    .arFrame {
      position: relative;
      width: 100%;
      height: min(72vh, 640px);
      background: #111827;
    }
    .arFrame video {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      background: #111827;
    }
    .arHUD {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(17,24,39,0.55);
      color: white;
      padding: 8px 10px;
      border-radius: 12px;
      font-size: 12px;
      line-height: 1.35;
      border: 1px solid rgba(255,255,255,0.15);
      z-index: 10;
    }
    .waterLabel {
      position: absolute;
      right: 10px;
      transform: translateY(-50%);
      background: rgba(239,68,68,0.92);
      color: white;
      padding: 6px 8px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 900;
      border: 1px solid rgba(255,255,255,0.2);
      z-index: 11;
      white-space: nowrap;
    }

    /* â€˜ã„´ì+ë¼ìš´ë“œâ€™ ê¸°ì¤€ ë¼ì¸ */
    .baseCurve{
      position: absolute;
      left: 10px;
      right: 10px;
      height: 70px;
      top: 78%;
      transform: translateY(-50%);
      z-index: 9;
      pointer-events: none;
    }
    .baseCurve path{
      fill: none;
      stroke: rgba(59,130,246,0.95);
      stroke-width: 14;
      stroke-linecap: round;
      stroke-linejoin: round;
    }

    .baseNote {
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      background: #eff6ff;
      border: 1px solid #bfdbfe;
      color: #1e3a8a;
      font-size: 12px;
      font-weight: 900;
      line-height: 1.35;
    }

    /* ===== í•˜ë‹¨ ê³ ì • ë¦¬ì›Œë“œ ===== */
    .rewardDock {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      padding: 10px 12px;
      z-index: 9999;
    }
    .dockInner {
      max-width: 420px;
      margin: 0 auto;
      background: rgba(255,255,255,0.96);
      border: 1px solid #e5e7eb;
      border-radius: 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.12);
      padding: 12px 14px;
      backdrop-filter: blur(8px);
      cursor: pointer;
      user-select: none;
    }
    .dockTop { display: flex; justify-content: space-between; align-items: center; }
    .dockTitle { font-size: 13px; font-weight: 900; color: #111827; }
    .dockPoint { font-size: 13px; font-weight: 900; color: #111827; }
    .dockBarTrack {
      margin-top: 8px;
      width: 100%;
      height: 12px;
      background: #e5e7eb;
      border-radius: 999px;
      overflow: hidden;
    }
    .dockBarFill {
      height: 100%;
      width: 0%;
      background: #111827;
      border-radius: 999px;
      transition: width 0.35s ease;
    }
    .dockBottom {
      margin-top: 8px;
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: #4b5563;
    }
    .dockBottom b { color: #111827; }

    .locLabel {
      display: none;
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      background: white;
      border: 1px solid #e5e7eb;
      font-size: 12px;
      color: #111827;
      font-weight: 900;
      justify-content: space-between;
      align-items: center;
    }

    /* ====== í™ˆì— ë“¤ì–´ê°ˆ 'í”„ë¡œí•„' ì¹´ë“œ(í´ë¦­) ====== */
    .passportHomeCard{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      cursor:pointer;
      user-select:none;
    }
    .passportLeft{
      display:flex;
      gap:12px;
      align-items:center;
      min-width: 0;
    }
    .passportIcon{
      width: 44px;
      height: 44px;
      border-radius: 14px;
      background:#f3f4f6;
      display:grid;
      place-items:center;
      font-size: 22px;
      flex: 0 0 auto;
    }
    .passportText{ min-width: 0; }
    .passportTitle{
      font-size: 14px;
      font-weight: 900;
      color:#111827;
      margin: 0;
    }
    .passportSub{
      font-size: 12px;
      color:#6b7280;
      margin-top: 4px;
      line-height: 1.35;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 260px;
    }
    .chev{
      width: 36px;
      height: 36px;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      background:#fff;
      display:grid;
      place-items:center;
      font-weight: 900;
      color:#111827;
      flex: 0 0 auto;
    }

    /* ====== ëª¨ë‹¬(ë¦¬ì›Œë“œ/í”„ë¡œí•„/ê´€ë¦¬ì) ====== */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(17,24,39,0.55);
      z-index: 100000;
      display: none;
      padding: 14px;
    }
    .modal.show { display: grid; place-items: center; }
    .modalSheet {
      width: 100%;
      max-width: 420px;
      height: min(92vh, 860px);
      background: #f4f5f7;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 18px 60px rgba(0,0,0,0.35);
      border: 1px solid rgba(255,255,255,0.18);
      display: flex;
      flex-direction: column;
    }
    .modalTopBar{
      background: #fff;
      padding: 14px 14px;
      border-bottom: 1px solid #e5e7eb;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
    }
    .modalTopTitle{
      font-size: 15px;
      font-weight: 900;
      color:#111827;
    }
    .closeBtn{
      width: 40px;
      height: 40px;
      border-radius: 14px;
      border: 1px solid #e5e7eb;
      background: #fff;
      font-weight: 900;
      cursor:pointer;
    }
    .modalScroll{
      overflow: auto;
      padding-bottom: 16px;
    }

    /* ====== ì‹œì•ˆ ê¸°ë°˜ ë¦¬ì›Œë“œ/í”„ë¡œí•„ ì»´í¬ë„ŒíŠ¸(ëª¨ë‹¬ ì•ˆ) ====== */
    .page-header {
      background: white;
      padding: 18px 16px;
      border-bottom: 1px solid #e8e8e8;
    }
    .page-title {
      font-size: 20px;
      font-weight: 900;
      color: #1a1a1a;
      margin-bottom: 6px;
    }
    .page-subtitle {
      font-size: 13px;
      color: #666;
      line-height: 1.45;
    }

    .points-card, .level-card {
      background: white;
      margin: 12px;
      border-radius: 16px;
      padding: 26px 16px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }
    .points-display {
      font-size: 46px;
      font-weight: 900;
      color: #111827;
      margin-bottom: 6px;
      letter-spacing: -1px;
    }
    .points-label {
      font-size: 13px;
      color: #666;
    }

    .section-label {
      font-size: 12px;
      color: #999;
      margin: 10px 0 10px 0;
      font-weight: 700;
      padding: 0 16px;
    }

    .benefits-list { padding: 0 12px 6px 12px; }
    .benefit-item {
      background: white;
      border-radius: 12px;
      padding: 14px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }
    .benefit-emoji {
      font-size: 24px;
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f8f9fa;
      border-radius: 12px;
      flex-shrink: 0;
    }
    .benefit-content { flex: 1; min-width: 0; }
    .benefit-name {
      font-size: 14px;
      font-weight: 900;
      color: #111827;
      margin-bottom: 4px;
    }
    .benefit-detail {
      font-size: 12px;
      color: #888;
      line-height: 1.3;
    }
    .benefit-button {
      background: #111827;
      color: white;
      border: none;
      padding: 10px 14px;
      border-radius: 10px;
      font-size: 12px;
      font-weight: 900;
      cursor: pointer;
      white-space: nowrap;
    }

    .rewards-footer, .progress-card {
      background: white;
      margin: 12px;
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }

    .next-reward {
      font-size: 13px;
      color: #666;
      margin-bottom: 12px;
      text-align: center;
      line-height: 1.35;
    }
    .next-reward strong { color: #111827; font-weight: 900; }

    .action-button {
      background: #111827;
      color: white;
      border: none;
      padding: 14px;
      border-radius: 14px;
      font-size: 14px;
      font-weight: 900;
      cursor: pointer;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    /* profile (modal) */
    .level-icon {
      width: 68px;
      height: 68px;
      background: #f8f9fa;
      border-radius: 50%;
      margin: 0 auto 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 34px;
    }
    .level-text {
      font-size: 18px;
      font-weight: 900;
      color: #111827;
      margin-bottom: 6px;
    }
    .level-desc {
      font-size: 12px;
      color: #888;
      line-height: 1.35;
    }

    .content-section {
      background: white;
      margin: 12px;
      border-radius: 16px;
      padding: 14px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }
    .stats-grid { display: grid; gap: 10px; }
    .stat-box {
      background: white;
      border-radius: 12px;
      padding: 14px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: 1px solid #eef0f3;
    }
    .stat-name { font-size: 13px; color: #666; font-weight: 700; }
    .stat-number { font-size: 20px; font-weight: 900; color: #111827; }

    .progress-label {
      font-size: 13px;
      color: #111827;
      margin-bottom: 10px;
      font-weight: 900;
      text-align: left;
    }
    .progress-track {
      background: #e8e8e8;
      height: 10px;
      border-radius: 6px;
      overflow: hidden;
      margin-bottom: 10px;
    }
    .progress-bar-fill {
      background: #111827;
      height: 100%;
      width: 0%;
      border-radius: 6px;
      transition: width .35s ease;
    }
    .progress-info {
      font-size: 12px;
      color: #888;
      text-align: center;
      line-height: 1.35;
    }

    /* ===== ì´¬ì˜(ë°”ë¡œ ì¹´ë©”ë¼ ìº¡ì³) ===== */
    .capFrame {
      position: relative;
      width: 100%;
      height: min(58vh, 520px);
      background: #111827;
    }
    .capFrame video{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      background:#111827;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="card">
      <h1 id="appTitle">ì œì£¼ ì—°ì•ˆ ìœ„í—˜ ì§€ë„</h1>
      <p class="desc">
        <b>ìš°ë¦¬ ëª¨ë‘ í•¨ê»˜ ë§Œë“œëŠ” ì•ˆì „ ëª¨ë‹ˆí„°ë§</b><br />
        ì‘ì€ í–‰ë™ì´ ì œì£¼ë„ë¥¼ ì§€í‚µë‹ˆë‹¤. í•¨ê»˜í•˜ê³  ë³´ìƒ ë°›ì•„ìš”!
      </p>
    </div>

    <!-- âœ… í™ˆ: í”„ë¡œí•„ ì¹´ë“œ (ì œëª©ê³¼ ì§€ë„ ì‚¬ì´) -->
    <div id="passportHome" class="card passportHomeCard" role="button" aria-label="í”„ë¡œí•„ ì—´ê¸°">
      <div class="passportLeft">
        <div class="passportIcon">ğŸ‘¤</div>
        <div class="passportText">
          <p class="passportTitle">í”„ë¡œí•„</p>
          <div id="passportHomeSub" class="passportSub">ì°¸ì—¬ ê¸°ë¡ê³¼ ë ˆë²¨ì„ í™•ì¸í•´ìš”</div>
        </div>
      </div>
      <div class="chev">â€º</div>
    </div>

    <div class="card">
      <div class="mapBox">
        <img src="jeju-risk-map.png" alt="Jeju Risk Map" />
        <div class="legend">
          <b>ìœ„í—˜ ë“±ê¸‰</b>
          ğŸŸ¢ ë³´í†µ&nbsp;&nbsp; ğŸŸ£ ìš°ë ¤&nbsp;&nbsp; ğŸ”´ ì‹¬ê°
        </div>
      </div>
    </div>

    <div class="card">
      <button id="btnUpload" class="btn btnBlack">ğŸ“¸ ì‚¬ì§„ ì œë³´í•˜ê¸°</button>

      <div id="uploadPanel" class="panel">
        <p class="panelTitle">ì‚¬ì§„ ì œë³´</p>
        <p class="guide">
          ë¨¼ì € <b>í˜„ì¬ ìœ„ì¹˜</b>ë¥¼ ì…ë ¥í•˜ê³  ë‹ë³´ê¸°ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.<br />
          ê·¸ëŸ¬ë©´ ê¶Œì¥ ì´¬ì˜ ê°ë„ ìƒ˜í”Œì„ ë³´ì—¬ì¤„ê²Œìš”.
        </p>

        <div class="searchRow">
          <input id="uploadLocInput" placeholder="í˜„ì¬ ìœ„ì¹˜ ì…ë ¥ (ì˜ˆ: í˜‘ì¬)" />
          <button id="uploadLocSearch" class="searchBtn" title="ê²€ìƒ‰">ğŸ”</button>
        </div>

        <div id="uploadLocStatus" class="status"></div>

        <div id="sampleWrap" class="sampleWrap">
          <div class="sampleHeader">
            <span>ê¶Œì¥ ì´¬ì˜ ê°ë„ ìƒ˜í”Œ</span>
            <span class="badge">í˜‘ì¬(ì‹œì•ˆ)</span>
          </div>

          <div class="sampleBody">
            <img id="sampleImg" src="sample-hyeopjae.jpg" alt="ìƒ˜í”Œ ì‚¬ì§„" />
            <div id="sampleFallback" class="sampleFallback">
              ìƒ˜í”Œ ì‚¬ì§„ íŒŒì¼ì„ ì•„ì§ ë„£ì§€ ì•Šì•˜ì–´ìš”.<br/><br/>
              í´ë”ì— <b>sample-hyeopjae.jpg</b>ë¥¼ ë„£ìœ¼ë©´<br/>
              ì´ ì˜ì—­ì— ìë™ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.
            </div>
          </div>
        </div>

        <div id="shotHint" class="shotHint">
          ğŸ“Œ <b>ëŒ ì¥ì‹ì´ í™”ë©´ ì™¼ìª½ ì•„ë˜</b>ì— ìœ„ì¹˜í•˜ë„ë¡ ì´¬ì˜í•´ì£¼ì„¸ìš”.
        </div>

        <!-- âœ… ì—…ë¡œë“œ(íŒŒì¼) ì œê±° â†’ ë°”ë¡œ ì´¬ì˜ -->
        <p class="guide" style="margin-top:12px;">
          ìƒ˜í”Œì„ í™•ì¸í•œ ë’¤, <b>íŒŒë€ ê¸°ì¤€ì„ </b>ì— ë§ì¶° <b>ì´¬ì˜</b>í•˜ë©´<br/>
          ì¦‰ì‹œ ì—…ë¡œë“œë˜ê³  <b>+10P</b>ê°€ ì ë¦½ë©ë‹ˆë‹¤.
        </p>

        <div id="captureControls" class="arControls" style="display:none;">
          <button id="startCaptureCam" class="uploadBtn">ğŸ“· ì´¬ì˜ ëª¨ë“œ ì‹œì‘</button>
          <button id="takeShot" class="uploadBtn" style="display:none;">ğŸ“¸ ì´¬ì˜(ì—…ë¡œë“œ)</button>
          <button id="stopCaptureCam" class="ghostBtn" style="display:none;">ì¢…ë£Œ</button>
        </div>

        <div id="captureStage" class="arWrap" style="display:none;">
          <div class="capFrame">
            <video id="capVideo" autoplay playsinline></video>

            <!-- íŒŒë€ ê¸°ì¤€ ë¼ì¸ -->
            <svg class="baseCurve" viewBox="0 0 200 80" preserveAspectRatio="none" aria-hidden="true">
              <path d="M10,20
                       Q40,20 55,40
                       L70,60
                       L190,60" />
            </svg>

            <div class="arHUD">
              <b>ì´¬ì˜ ê°€ì´ë“œ</b><br/>
              íŒŒë€ ì„ (ëŒë¶€ë¦¬ ê¸°ì¤€)ì— ë§ì¶˜ ë’¤ ì´¬ì˜í•˜ì„¸ìš”
            </div>
          </div>

          <div class="baseNote">
            ğŸ“Œ <b>íŒŒë€ ê¸°ì¤€ì„ </b>ì— ë§ì¶° ì´¬ì˜ ë¶€íƒë“œë¦½ë‹ˆë‹¤.
          </div>
        </div>

        <canvas id="capCanvas" style="display:none;"></canvas>

        <div id="shotPreviewWrap" class="sampleWrap" style="display:none;">
          <div class="sampleHeader">
            <span>ë°©ê¸ˆ ì´¬ì˜í•œ ì‚¬ì§„(ì—…ë¡œë“œë¨)</span>
            <span class="badge">âœ…</span>
          </div>
          <div class="sampleBody">
            <img id="shotPreviewImg" alt="ì´¬ì˜ ë¯¸ë¦¬ë³´ê¸°" />
          </div>
        </div>

        <div id="uploadStatus" class="status"></div>
      </div>

      <div style="height:10px;"></div>

      <button id="btnPredict" class="btn btnWhite">ğŸ”® ë¯¸ë˜ ì˜ˆì¸¡ ë³´ê¸° (AR)</button>

      <div id="predictPanel" class="panel">
        <p class="panelTitle">ë¯¸ë˜ ì˜ˆì¸¡(AR ì‹œì•ˆ)</p>
        <p class="guide">
          í˜„ì¬ ìœ„ì¹˜ë¥¼ ì…ë ¥í•˜ê³  ë‹ë³´ê¸°ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.<br />
          (ì§€ê¸ˆì€ <b>í˜‘ì¬</b>ë§Œ ì‹œì•ˆìœ¼ë¡œ ì—°ê²°ë˜ì–´ ìˆì–´ìš”)
        </p>

        <div class="searchRow">
          <input id="predictLocInput" placeholder="í˜„ì¬ ìœ„ì¹˜ ì…ë ¥ (ì˜ˆ: í˜‘ì¬)" />
          <button id="predictLocSearch" class="searchBtn" title="ê²€ìƒ‰">ğŸ”</button>
        </div>

        <div id="predictLocStatus" class="status"></div>

        <div id="locLabel" class="locLabel">
          <span>í˜„ì¬ ìœ„ì¹˜: <b id="locName">í˜‘ì¬</b> (ì‹œì•ˆ)</span>
          <span class="badge">ON</span>
        </div>

        <div id="predictBox" class="predictBox">
          <button id="p5" class="pill active">5ë…„ ë’¤</button>
          <button id="p10" class="pill">10ë…„ ë’¤</button>
        </div>

        <div id="predictText" class="predictText"></div>

        <div id="arControls" class="arControls">
          <button id="startAR" class="uploadBtn">ğŸ“· AR ëª¨ë“œ ì‹œì‘</button>
          <button id="stopAR" class="ghostBtn" style="display:none;">ì¢…ë£Œ</button>
        </div>

        <div id="arStage" class="arWrap">
          <div class="arFrame">
            <video id="arVideo" autoplay playsinline></video>

            <!-- ë¹¨ê°„ ì˜ˆìƒ ìˆ˜ìœ„ì„  -->
            <div id="waterLine" style="
              position:absolute; left:0; right:0;
              height:3px; background:#ef4444;
              top:62%;
              box-shadow: 0 0 0 2px rgba(239,68,68,0.25);
              z-index: 6;
            "></div>

            <div id="waterFill" style="
              position:absolute; left:0; right:0; bottom:0;
              top:62%;
              background: rgba(239,68,68,0.25);
              z-index: 5;
            "></div>

            <!-- íŒŒë€ ê¸°ì¤€ ë¼ì¸ -->
            <svg id="baseCurve" class="baseCurve" viewBox="0 0 200 80" preserveAspectRatio="none" aria-hidden="true">
              <path d="M10,20
                       Q40,20 55,40
                       L70,60
                       L190,60" />
            </svg>

            <div class="arHUD">
              <b>í˜‘ì¬ AR ì‹œì•ˆ</b><br/>
              ë¹¨ê°„ ì„  = ì˜ˆìƒ ìˆ˜ìœ„<br/>
              íŒŒë€ ì„  = ê¸°ì¤€(ëŒë¶€ë¦¬)
            </div>

            <div id="waterLabel" class="waterLabel" style="top:62%;">ì˜ˆìƒ ìˆ˜ìœ„ 0.5m</div>
          </div>

          <div class="baseNote">
            ğŸ“Œ <b>ëŒë¶€ë¦¬ì— ë§ì¶°</b> ì¸¡ì • ë¶€íƒë“œë¦½ë‹ˆë‹¤.
          </div>
        </div>

        <p class="hint">* ë°ëª¨ ë²„ì „: ìˆ˜ì¹˜/ë²”ìœ„ëŠ” ë°œí‘œìš© ì‹œë‚˜ë¦¬ì˜¤ ê°’ì…ë‹ˆë‹¤.</p>
      </div>

      <p class="hint">* ì‹¤ë‚´ QR ì‹œì—°ìš©: ì¹´ë©”ë¼ í™”ë©´ ìœ„ì— ìˆ˜ìœ„ ì˜¤ë²„ë ˆì´ë¡œ í‘œí˜„ë©ë‹ˆë‹¤.</p>
    </div>
  </div>

  <div id="toast" class="toast">+10P</div>

  <!-- ===== í•˜ë‹¨ ê³ ì • ë¦¬ì›Œë“œ (í´ë¦­ ì‹œ ëª¨ë‹¬ ì—´ë¦¼) ===== -->
  <div class="rewardDock">
    <div id="rewardDockBtn" class="dockInner" role="button" aria-label="ë‚´ ë¦¬ì›Œë“œ ì—´ê¸°">
      <div class="dockTop">
        <div class="dockTitle">âš¡ ë‚´ ë¦¬ì›Œë“œ</div>
        <div class="dockPoint"><span id="mePointDock">0</span>P</div>
      </div>

      <div class="dockBarTrack">
        <div id="barFillDock" class="dockBarFill"></div>
      </div>

      <div class="dockBottom">
        <span>ë‹¤ìŒ ë¦¬ì›Œë“œê¹Œì§€ <b id="toNextDock">100</b>P</span>
        <span>ì—…ë¡œë“œ <b id="uploadCountDock">0</b>íšŒ</span>
      </div>
    </div>
  </div>

  <!-- ===================== ëª¨ë‹¬: ë‚´ ë¦¬ì›Œë“œ ===================== -->
  <div id="rewardModal" class="modal" aria-hidden="true">
    <div class="modalSheet">
      <div class="modalTopBar">
        <div class="modalTopTitle">ë‚´ ë¦¬ì›Œë“œ</div>
        <button id="closeReward" class="closeBtn" aria-label="ë‹«ê¸°">âœ•</button>
      </div>

      <div class="modalScroll">
        <div class="page-header">
          <div class="page-title">ë‚´ ë¦¬ì›Œë“œ</div>
          <div class="page-subtitle">í•´ì•ˆ ì•ˆì „ ì°¸ì—¬ë¡œ ì ë¦½ëœ í˜œíƒì„<br/>í™•ì¸í•˜ê³  ì‚¬ìš©í•˜ì„¸ìš”</div>
        </div>

        <div class="points-card">
          <div id="rewardPointBig" class="points-display">0P</div>
          <div class="points-label">ì‚¬ìš© ê°€ëŠ¥ í¬ì¸íŠ¸</div>
        </div>

        <div class="section-label">ì‚¬ìš© ê°€ëŠ¥í•œ í˜œíƒ</div>

        <div class="benefits-list">
          <div class="benefit-item">
            <div class="benefit-emoji">ğŸª™</div>
            <div class="benefit-content">
              <div class="benefit-name">íƒë‚˜ëŠ”ì „ ì „í™˜</div>
              <div class="benefit-detail">1,000P â†’ 1,000ì›</div>
            </div>
            <button class="benefit-button" onclick="alert('ë°ëª¨ í™”ë©´ì…ë‹ˆë‹¤ ğŸ™‚')">ì‚¬ìš©</button>
          </div>

          <div class="benefit-item">
            <div class="benefit-emoji">â˜•</div>
            <div class="benefit-content">
              <div class="benefit-name">ê·¼ì²˜ ì¹´í˜ í• ì¸</div>
              <div class="benefit-detail">í•´ì•ˆ ì¸ì¦ ì‹œ 10% í• ì¸</div>
            </div>
            <button class="benefit-button" onclick="alert('ë°ëª¨ í™”ë©´ì…ë‹ˆë‹¤ ğŸ™‚')">ì‚¬ìš©</button>
          </div>

          <div class="benefit-item">
            <div class="benefit-emoji">ğŸŸ</div>
            <div class="benefit-content">
              <div class="benefit-name">ê´€ê´‘ í”„ë¡œê·¸ë¨</div>
              <div class="benefit-detail">í•´ì•ˆ ì²´í—˜ ë¬´ë£Œ ì°¸ì—¬ê¶Œ</div>
            </div>
            <button class="benefit-button" onclick="alert('ë°ëª¨ í™”ë©´ì…ë‹ˆë‹¤ ğŸ™‚')">ì‚¬ìš©</button>
          </div>
        </div>

        <div class="rewards-footer">
          <div class="next-reward">ë‹¤ìŒ ë¦¬ì›Œë“œê¹Œì§€ <strong id="rewardLeftBig">0P</strong> ë‚¨ì•˜ì–´ìš”</div>
          <button id="goARFromReward" class="action-button">
            <span>ğŸ“¸</span>
            <span>ë¯¸ë˜ ì˜ˆì¸¡ ë³´ê¸° (AR)</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ===================== ëª¨ë‹¬: í”„ë¡œí•„ ===================== -->
  <div id="passportModal" class="modal" aria-hidden="true">
    <div class="modalSheet">
      <div class="modalTopBar">
        <div class="modalTopTitle">í”„ë¡œí•„</div>
        <button id="closePassport" class="closeBtn" aria-label="ë‹«ê¸°">âœ•</button>
      </div>

      <div class="modalScroll">
        <div class="page-header">
          <div class="page-title">í”„ë¡œí•„</div>
          <div class="page-subtitle">í•´ì•ˆ ì•ˆì „ì„ í•¨ê»˜ ì§€ì¼œì˜¨<br/>ë‚˜ì˜ ì°¸ì—¬ ê¸°ë¡ì…ë‹ˆë‹¤</div>
        </div>

        <div class="level-card">
          <div class="level-icon">ğŸ–ï¸</div>
          <div id="passportLevelText" class="level-text">Lv.1 í•´ì•ˆ ìƒˆì‹¹</div>
          <div id="passportLevelDesc" class="level-desc">ê¾¸ì¤€í•œ ì°¸ì—¬ë¡œ ì•ˆì „í•œ í•´ì•ˆì„ ë§Œë“¤ì–´ê°€ê³  ìˆì–´ìš”</div>
        </div>

        <div class="section-label">ëˆ„ì  ì°¸ì—¬ ê¸°ë¡</div>

        <div class="content-section">
          <div class="stats-grid">
            <div class="stat-box">
              <div class="stat-name">ë°©ë¬¸í•œ í•´ì•ˆ</div>
              <div id="statVisited" class="stat-number">0ê³³</div>
            </div>
            <div class="stat-box">
              <div class="stat-name">ì°¸ì—¬í•œ ì¸ì¦</div>
              <div id="statUploads" class="stat-number">0íšŒ</div>
            </div>
            <div class="stat-box">
              <div class="stat-name">ëˆ„ì  ì°¸ì—¬ ì¼ìˆ˜</div>
              <div id="statDays" class="stat-number">0ì¼</div>
            </div>
          </div>
        </div>

        <div class="progress-card">
          <div class="progress-label">ë‹¤ìŒ ë ˆë²¨ê¹Œì§€</div>
          <div class="progress-track">
            <div id="passportProgressFill" class="progress-bar-fill"></div>
          </div>
          <div id="passportProgressInfo" class="progress-info">0íšŒ ì°¸ì—¬ ë” í•„ìš” (0% ë‹¬ì„±)</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===================== ê´€ë¦¬ì ì½”ë“œ ì…ë ¥ ëª¨ë‹¬ ===================== -->
  <div id="adminCodeModal" class="modal" aria-hidden="true">
    <div class="modalSheet" style="height:auto; max-height: 78vh;">
      <div class="modalTopBar">
        <div class="modalTopTitle">ê´€ë¦¬ì ëª¨ë“œ</div>
        <button id="closeAdminCode" class="closeBtn" aria-label="ë‹«ê¸°">âœ•</button>
      </div>

      <div class="modalScroll" style="padding: 14px;">
        <div class="card" style="box-shadow:none; border:1px solid #e5e7eb;">
          <div style="font-weight: 900; font-size: 14px; color:#111827; margin-bottom: 8px;">
            ê´€ë¦¬ì ì „ìš© ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”
          </div>

          <input id="adminCodeInput" inputmode="numeric" placeholder=""
                 style="width:100%; padding:12px 12px; border-radius:12px; border:1px solid #e5e7eb; font-size:14px; outline:none;">

          <div id="adminCodeMsg" style="margin-top:10px; font-size:12px; font-weight:900; color:#ef4444; display:none;">
            ì½”ë“œê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.
          </div>

          <div style="display:flex; gap:10px; margin-top:12px;">
            <button id="adminCodeSubmit" class="uploadBtn" style="flex:1;">í™•ì¸</button>
            <button id="adminCodeCancel" class="ghostBtn" style="flex:1;">ì·¨ì†Œ</button>
          </div>
        </div>

        <p class="hint" style="margin-top:10px;">
          * ì œëª©ì„ ì—°ì† 3ë²ˆ ëˆ„ë¥´ë©´ ê´€ë¦¬ì ëª¨ë“œë¡œ ì§„ì…í•©ë‹ˆë‹¤.
        </p>
      </div>
    </div>
  </div>

  <script>
    // ====== ë¦¬ì›Œë“œ ======
    const MAX_POINT = 100;
    const savedPoint = Number(localStorage.getItem("myPoint") || "0");
    const savedCount = Number(localStorage.getItem("myUploadCount") || "0");

    let myPoint = savedPoint;
    let uploadCount = savedCount;

    const toast = document.getElementById("toast");
    const mePointDock = document.getElementById("mePointDock");
    const uploadCountDock = document.getElementById("uploadCountDock");
    const toNextDock = document.getElementById("toNextDock");
    const barFillDock = document.getElementById("barFillDock");

    function showToast(text) {
      toast.textContent = text;
      toast.classList.remove("show");
      void toast.offsetWidth;
      toast.classList.add("show");
    }

    function updateRewardUI() {
      const percent = Math.min(100, (myPoint / MAX_POINT) * 100);
      const left = Math.max(0, MAX_POINT - myPoint);

      mePointDock.textContent = myPoint;
      uploadCountDock.textContent = uploadCount;
      toNextDock.textContent = left;
      barFillDock.style.width = percent + "%";

      localStorage.setItem("myPoint", String(myPoint));
      localStorage.setItem("myUploadCount", String(uploadCount));

      const big = document.getElementById("rewardPointBig");
      const leftBig = document.getElementById("rewardLeftBig");
      if (big) big.textContent = `${myPoint}P`;
      if (leftBig) leftBig.textContent = `${left}P`;
    }

    function addPoint(amount) {
      myPoint = Math.min(MAX_POINT, myPoint + amount);
      uploadCount += 1;
      updateRewardUI();
      updateProfileUI();
      showToast(`+${amount}P`);
    }

    updateRewardUI();

    // ====== íŒ¨ë„ í† ê¸€ ======
    const btnUpload = document.getElementById("btnUpload");
    const btnPredict = document.getElementById("btnPredict");
    const uploadPanel = document.getElementById("uploadPanel");
    const predictPanel = document.getElementById("predictPanel");

    function togglePanel(panel) {
      if (panel === uploadPanel) predictPanel.style.display = "none";
      if (panel === predictPanel) uploadPanel.style.display = "none";
      panel.style.display = panel.style.display === "block" ? "none" : "block";
    }
    btnUpload.addEventListener("click", () => togglePanel(uploadPanel));
    btnPredict.addEventListener("click", () => togglePanel(predictPanel));

    // ====== í˜‘ì¬ ë§¤ì¹­ ======
    function normalize(s) { return (s || "").trim().replace(/\s+/g, ""); }
    function isHyeopjae(input) { return normalize(input).includes("í˜‘ì¬"); }

    function showStatus(el, message, sub) {
      el.style.display = "block";
      el.innerHTML = `${message}<small>${sub || ""}</small>`;
    }

    // ====== ì—…ë¡œë“œ: ìœ„ì¹˜ ê²€ìƒ‰ + ìƒ˜í”Œ ======
    const uploadLocInput = document.getElementById("uploadLocInput");
    const uploadLocSearch = document.getElementById("uploadLocSearch");
    const uploadLocStatus = document.getElementById("uploadLocStatus");

    const sampleWrap = document.getElementById("sampleWrap");
    const sampleImg = document.getElementById("sampleImg");
    const sampleFallback = document.getElementById("sampleFallback");
    const shotHint = document.getElementById("shotHint");

    sampleImg.onerror = () => {
      sampleFallback.style.display = "grid";
      sampleImg.style.display = "none";
    };
    sampleImg.onload = () => {
      sampleFallback.style.display = "none";
      sampleImg.style.display = "block";
    };

    // ====== ì´¬ì˜(ë°”ë¡œ ìº¡ì³) ======
    const captureControls = document.getElementById("captureControls");
    const startCaptureCamBtn = document.getElementById("startCaptureCam");
    const takeShotBtn = document.getElementById("takeShot");
    const stopCaptureCamBtn = document.getElementById("stopCaptureCam");

    const captureStage = document.getElementById("captureStage");
    const capVideo = document.getElementById("capVideo");
    const capCanvas = document.getElementById("capCanvas");

    const uploadStatus = document.getElementById("uploadStatus");

    const shotPreviewWrap = document.getElementById("shotPreviewWrap");
    const shotPreviewImg = document.getElementById("shotPreviewImg");

    let capStream = null;

    async function startCaptureCam() {
      try {
        capStream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: "environment" },
          audio: false
        });

        capVideo.srcObject = capStream;

        captureStage.style.display = "block";
        takeShotBtn.style.display = "inline-block";
        stopCaptureCamBtn.style.display = "inline-block";
        startCaptureCamBtn.style.display = "none";

        showStatus(uploadStatus, "âœ… ì´¬ì˜ ëª¨ë“œ ì¤€ë¹„ ì™„ë£Œ", "íŒŒë€ ê¸°ì¤€ì„ ì— ë§ì¶˜ ë’¤ ì´¬ì˜(ì—…ë¡œë“œ)ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.");
      } catch (e) {
        alert("ì¹´ë©”ë¼ ê¶Œí•œì´ í•„ìš”í•´ìš”. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ì¹´ë©”ë¼ í—ˆìš© í›„ ë‹¤ì‹œ ì‹œë„í•´ì¤˜!");
      }
    }

    function stopCaptureCam() {
      if (capStream) {
        capStream.getTracks().forEach(t => t.stop());
        capStream = null;
      }
      captureStage.style.display = "none";
      takeShotBtn.style.display = "none";
      stopCaptureCamBtn.style.display = "none";
      startCaptureCamBtn.style.display = "inline-block";
    }

    let pendingReward = false; // ì¤‘ë³µ ì ë¦½ ë°©ì§€

    function openPopupThenReward(amount) {
      // roading.htmlì´ ë©”ì¸ htmlê³¼ "ê°™ì€ í´ë”"ì— ìˆì–´ì•¼ í•¨
      const W = 440;
      const H = 780;
      const left = Math.max(0, Math.floor((screen.width - W) / 2));
      const top = Math.max(0, Math.floor((screen.height - H) / 2));

      const popup = window.open(
        "roading.html",
        "UploadInfoPopup",
        `width=${W},height=${H},left=${left},top=${top},resizable=yes,scrollbars=yes`
      );

      // íŒì—… ì°¨ë‹¨ ì‹œ ì˜ˆì™¸ ì²˜ë¦¬
      if (!popup) {
        alert("íŒì—…ì´ ì°¨ë‹¨ë˜ì–´ ì•ˆë‚´ì°½ì„ ì—´ ìˆ˜ ì—†ì–´ìš”. íŒì—… í—ˆìš© í›„ ë‹¤ì‹œ ì‹œë„í•´ì¤˜!");
        // íŒì—… ëª» ì—´ë©´ ì ë¦½ì„ ì–´ë–»ê²Œ í• ì§€ ì„ íƒ: ì—¬ê¸°ì„œëŠ” 'ë°”ë¡œ ì ë¦½' ëŒ€ì‹  ì•ˆë‚´ í›„ ì¤‘ë‹¨
        pendingReward = false;
        showStatus(uploadStatus, "âš ï¸ ì•ˆë‚´ì°½ì„ ì—´ ìˆ˜ ì—†ì–´ìš”.", "ë¸Œë¼ìš°ì €ì—ì„œ íŒì—… í—ˆìš© í›„ ë‹¤ì‹œ ì´¬ì˜í•´ì£¼ì„¸ìš”.");
        return;
      }

      // ë‹«í˜ ê°ì§€(í´ë§)
      const timer = setInterval(() => {
        if (popup.closed) {
          clearInterval(timer);
          pendingReward = false;

          // âœ… íŒì—…ì„ ë‹«ì€ ë’¤ì— í¬ì¸íŠ¸ ì ë¦½
          addPoint(amount);
          showStatus(uploadStatus, "âœ… ì•ˆë‚´ í™•ì¸ ì™„ë£Œ! +10P ì§€ê¸‰", "ì œë³´ê°€ ë°˜ì˜ë˜ì—ˆìŠµë‹ˆë‹¤(ë°ëª¨).");
        }
      }, 250);
    }

    function takeShotAndUpload() {
      if (!capStream) {
        showStatus(uploadStatus, "âš ï¸ ì¹´ë©”ë¼ê°€ ì•„ì§ ì‹œì‘ë˜ì§€ ì•Šì•˜ì–´ìš”.", "ì´¬ì˜ ëª¨ë“œ ì‹œì‘ì„ ë¨¼ì € ëˆŒëŸ¬ì£¼ì„¸ìš”.");
        return;
      }
      if (pendingReward) return; // ì—°íƒ€ ë°©ì§€
      pendingReward = true;

      const w = capVideo.videoWidth || 1280;
      const h = capVideo.videoHeight || 720;

      capCanvas.width = w;
      capCanvas.height = h;

      const ctx = capCanvas.getContext("2d");
      ctx.drawImage(capVideo, 0, 0, w, h);

      const imgDataUrl = capCanvas.toDataURL("image/jpeg", 0.92);

      // ë¯¸ë¦¬ë³´ê¸°
      shotPreviewImg.src = imgDataUrl;
      shotPreviewWrap.style.display = "block";

      // ì—…ë¡œë“œ ë°ëª¨ ì²˜ë¦¬
      showStatus(uploadStatus, "â³ ì—…ë¡œë“œ ì¤‘...", "ì´¬ì˜í•œ ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ê³  ìˆì–´ìš”.");

      setTimeout(() => {
        // âœ… ì—…ë¡œë“œëŠ” ëë‚¬ì§€ë§Œ, ì•„ì§ í¬ì¸íŠ¸ ì ë¦½ X
        showStatus(uploadStatus, "âœ… ì—…ë¡œë“œ ì™„ë£Œ", "ì•ˆë‚´ì°½ì„ í™•ì¸í•˜ê³  ë‹«ìœ¼ë©´ í¬ì¸íŠ¸ê°€ ì ë¦½ë©ë‹ˆë‹¤.");
        openPopupThenReward(10);
      }, 650);
    }

    startCaptureCamBtn.addEventListener("click", startCaptureCam);
    stopCaptureCamBtn.addEventListener("click", stopCaptureCam);
    takeShotBtn.addEventListener("click", takeShotAndUpload);
    window.addEventListener("beforeunload", () => stopCaptureCam());

    document.addEventListener("DOMContentLoaded", () => {
      const uploadLocSearch = document.getElementById("uploadLocSearch");
      const uploadLocInput  = document.getElementById("uploadLocInput");

      if (!uploadLocSearch || !uploadLocInput) {
        console.error("âŒ ë‹ë³´ê¸° ìš”ì†Œ ëª» ì°¾ìŒ");
        return;
      }

      uploadLocSearch.addEventListener("click", () => {
        console.log("ğŸ” ë‹ë³´ê¸° í´ë¦­ë¨");

        const v = uploadLocInput.value.trim();

        if (!v) {
        showStatus(uploadLocStatus, "âš ï¸ ìœ„ì¹˜ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.", "ì˜ˆ: í˜‘ì¬");
        return;
      }

      if (isHyeopjae(v)) {
        showStatus(uploadLocStatus, "âœ… ìœ„ì¹˜ í™•ì¸: í˜‘ì¬(ì‹œì•ˆ)", "ìƒ˜í”Œì„ í‘œì‹œí•©ë‹ˆë‹¤.");
        sampleWrap.style.display = "block";
        shotHint.style.display = "block";
        sampleImg.src = "sample-hyeopjae.jpg";
        captureControls.style.display = "flex";
      } else {
        showStatus(uploadLocStatus, "âš ï¸ í˜„ì¬ëŠ” â€˜í˜‘ì¬â€™ë§Œ ì‹œì•ˆ ì§€ì› ì¤‘ì…ë‹ˆë‹¤.", "í˜‘ì¬ë¡œ ì…ë ¥í•´ í…ŒìŠ¤íŠ¸í•´ ì£¼ì„¸ìš”.");
        sampleWrap.style.display = "none";
        shotHint.style.display = "none";
        captureControls.style.display = "none";
        }
      });
    });

    // ====== ì˜ˆì¸¡(AR): ìœ„ì¹˜ ê²€ìƒ‰ í›„ ê¸°ëŠ¥ ì—´ê¸° ======
    const predictLocInput = document.getElementById("predictLocInput");
    const predictLocSearch = document.getElementById("predictLocSearch");
    const predictLocStatus = document.getElementById("predictLocStatus");

    const locLabel = document.getElementById("locLabel");
    const locName = document.getElementById("locName");

    const predictBox = document.getElementById("predictBox");
    const predictText = document.getElementById("predictText");

    const arControls = document.getElementById("arControls");
    const startARBtn = document.getElementById("startAR");
    const stopARBtn = document.getElementById("stopAR");

    const arStage = document.getElementById("arStage");
    const arVideo = document.getElementById("arVideo");
    const waterLine = document.getElementById("waterLine");
    const waterFill = document.getElementById("waterFill");
    const waterLabel = document.getElementById("waterLabel");

    // 5ë…„ 0.5m / 10ë…„ 0.7m
    const scenarios = {
      y5:  { meter: 0.5, percent: 62, text: "âœ… 5ë…„ ë’¤(í˜‘ì¬): ì¼ë¶€ êµ¬ê°„ ì¹¨ìˆ˜ ê°€ëŠ¥ì„± ì¦ê°€\nì˜ˆìƒ ìˆ˜ìœ„: 0.5m" },
      y10: { meter: 0.7, percent: 45, text: "âš ï¸ 10ë…„ ë’¤(í˜‘ì¬): ì¹¨ìˆ˜ ë²”ìœ„ í™•ëŒ€ ê°€ëŠ¥ì„±\nì˜ˆìƒ ìˆ˜ìœ„: 0.7m" }
    };

    let currentScenarioKey = "y5";
    let arStream = null;

    const p5 = document.getElementById("p5");
    const p10 = document.getElementById("p10");

    function applyScenario(key) {
      currentScenarioKey = key;
      const s = scenarios[key];

      predictText.textContent = s.text;
      predictText.style.display = "block";

      waterLine.style.top = s.percent + "%";
      waterFill.style.top = s.percent + "%";
      waterLabel.style.top = s.percent + "%";
      waterLabel.textContent = `ì˜ˆìƒ ìˆ˜ìœ„ ${s.meter}m`;
    }

    p5.addEventListener("click", () => {
      p5.classList.add("active");
      p10.classList.remove("active");
      applyScenario("y5");
    });

    p10.addEventListener("click", () => {
      p10.classList.add("active");
      p5.classList.remove("active");
      applyScenario("y10");
    });

    function stopAR() {
      if (arStream) {
        arStream.getTracks().forEach(t => t.stop());
        arStream = null;
      }
      arStage.style.display = "none";
      stopARBtn.style.display = "none";
      startARBtn.style.display = "inline-block";
    }

    predictLocSearch.addEventListener("click", () => {
      const v = predictLocInput.value;
      if (!v.trim()) {
        showStatus(predictLocStatus, "âš ï¸ ìœ„ì¹˜ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.", "ì˜ˆ: í˜‘ì¬");
        return;
      }

      if (isHyeopjae(v)) {
        showStatus(predictLocStatus, "âœ… ìœ„ì¹˜ í™•ì¸: í˜‘ì¬(ì‹œì•ˆ)", "5ë…„/10ë…„ ë° AR ê¸°ëŠ¥ì„ í™œì„±í™”í•©ë‹ˆë‹¤.");

        locLabel.style.display = "flex";
        locName.textContent = "í˜‘ì¬";

        predictBox.style.display = "flex";
        arControls.style.display = "flex";

        p5.classList.add("active");
        p10.classList.remove("active");
        applyScenario("y5");
      } else {
        showStatus(predictLocStatus, "âš ï¸ í˜„ì¬ëŠ” â€˜í˜‘ì¬â€™ë§Œ ì‹œì•ˆ ì§€ì› ì¤‘ì…ë‹ˆë‹¤.", "í˜‘ì¬ë¡œ ì…ë ¥í•´ í…ŒìŠ¤íŠ¸í•´ ì£¼ì„¸ìš”.");

        locLabel.style.display = "none";
        predictBox.style.display = "none";
        predictText.style.display = "none";
        arControls.style.display = "none";
        stopAR();
      }
    });

    async function startAR() {
      try {
        arStream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: "environment" },
          audio: false
        });

        arVideo.srcObject = arStream;
        arStage.style.display = "block";
        stopARBtn.style.display = "inline-block";
        startARBtn.style.display = "none";

        applyScenario(currentScenarioKey);
      } catch (e) {
        alert("ì¹´ë©”ë¼ ê¶Œí•œì´ í•„ìš”í•´ìš”. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ì¹´ë©”ë¼ í—ˆìš© í›„ ë‹¤ì‹œ ì‹œë„í•´ì¤˜!");
      }
    }

    startARBtn.addEventListener("click", startAR);
        stopARBtn.addEventListener("click", stopAR);
    window.addEventListener("beforeunload", () => stopAR());

    // ====== ë‚´ ë¦¬ì›Œë“œ ëª¨ë‹¬ ======
    const rewardDockBtn = document.getElementById("rewardDockBtn");
    const rewardModal = document.getElementById("rewardModal");
    const closeReward = document.getElementById("closeReward");

    function openModal(modalEl) {
      modalEl.classList.add("show");
      modalEl.setAttribute("aria-hidden", "false");
      document.body.style.overflow = "hidden";
    }

    function closeModal(modalEl) {
      modalEl.classList.remove("show");
      modalEl.setAttribute("aria-hidden", "true");
      document.body.style.overflow = "";
    }

    rewardDockBtn.addEventListener("click", () => {
      updateRewardUI(); // í° ìˆ«ìë„ ë™ê¸°í™”
      openModal(rewardModal);
    });

    closeReward.addEventListener("click", () => closeModal(rewardModal));

    // ë°”ê¹¥(ë”¤) í´ë¦­í•˜ë©´ ë‹«ê¸°
    rewardModal.addEventListener("click", (e) => {
      if (e.target === rewardModal) closeModal(rewardModal);
    });

    // ====== í”„ë¡œí•„(íŒ¨ìŠ¤í¬íŠ¸) ëª¨ë‹¬ ======
    const passportHome = document.getElementById("passportHome");
    const passportModal = document.getElementById("passportModal");
    const closePassport = document.getElementById("closePassport");

    passportHome.addEventListener("click", () => {
      updateProfileUI();
      openModal(passportModal);
    });

    closePassport.addEventListener("click", () => closeModal(passportModal));
    passportModal.addEventListener("click", (e) => {
      if (e.target === passportModal) closeModal(passportModal);
    });

    // ====== ë¦¬ì›Œë“œ ëª¨ë‹¬ì—ì„œ ARë¡œ ì´ë™ ======
    const goARFromReward = document.getElementById("goARFromReward");
    goARFromReward.addEventListener("click", () => {
      closeModal(rewardModal);
      // ì˜ˆì¸¡ íŒ¨ë„ ì—´ê¸°
      predictPanel.style.display = "block";
      uploadPanel.style.display = "none";
      // ì…ë ¥ì¹¸ì— í˜‘ì¬ ìë™ ì…ë ¥(ë°ëª¨)
      predictLocInput.value = "í˜‘ì¬";
      predictLocSearch.click();
      // ìŠ¤í¬ë¡¤ ì‚´ì§ ë‚´ë ¤ì£¼ê¸°(ì„ íƒ)
      window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });
    });

    // ====== í”„ë¡œí•„ UI ì—…ë°ì´íŠ¸(í¬ì¸íŠ¸/ì—…ë¡œë“œ ê¸°ë°˜) ======
    function updateProfileUI() {
      // ì—…ë¡œë“œ ìˆ˜ ê¸°ì¤€ìœ¼ë¡œ ë ˆë²¨(ë°ëª¨)
      // 0~1: Lv1 / 2~4: Lv2 / 5~8: Lv3 / 9+: Lv4
      let level = 1;
      if (uploadCount >= 9) level = 4;
      else if (uploadCount >= 5) level = 3;
      else if (uploadCount >= 2) level = 2;

      const levelTextMap = {
        1: "Lv.1 í•´ì•ˆ ìƒˆì‹¹",
        2: "Lv.2 í•´ì•ˆ íŒŒìˆ˜ê¾¼",
        3: "Lv.3 í•´ì•ˆ ì§€í‚´ì´",
        4: "Lv.4 í•´ì•ˆ ë§ˆìŠ¤í„°",
      };
      const levelDescMap = {
        1: "ì²« ì°¸ì—¬ë¥¼ ì‹œì‘í–ˆì–´ìš”. ê³„ì† ê¸°ë¡í•´ë³´ì„¸ìš”!",
        2: "í•´ì•ˆì„ ê¾¸ì¤€íˆ ê´€ì°°í•˜ê³  ìˆì–´ìš”.",
        3: "ë°ì´í„°ê°€ ìŒ“ì´ë©° ì˜í–¥ë ¥ì´ ì»¤ì§€ê³  ìˆì–´ìš”.",
        4: "ìµœê³  ë ˆë²¨! ì œì£¼ í•´ì•ˆì˜ ë“ ë“ í•œ íŒŒíŠ¸ë„ˆì˜ˆìš”.",
      };

      const passportLevelText = document.getElementById("passportLevelText");
      const passportLevelDesc = document.getElementById("passportLevelDesc");
      passportLevelText.textContent = levelTextMap[level];
      passportLevelDesc.textContent = levelDescMap[level];

      // í†µê³„(ë°ëª¨): ë°©ë¬¸í•œ í•´ì•ˆ = ì—…ë¡œë“œ ìœ„ì¹˜ ìˆ˜ë¼ê³  ê°€ì •
      const visited = Math.max(1, Math.min(uploadCount, 12)); // ë°ëª¨ê°’
      document.getElementById("statVisited").textContent = `${uploadCount === 0 ? 0 : visited}ê³³`;
      document.getElementById("statUploads").textContent = `${uploadCount}íšŒ`;

      // ì°¸ì—¬ ì¼ìˆ˜(ë°ëª¨): ì—…ë¡œë“œ ìˆ˜ì— ë¹„ë¡€
      const days = uploadCount === 0 ? 0 : Math.min(30, Math.ceil(uploadCount / 2));
      document.getElementById("statDays").textContent = `${days}ì¼`;

      // ë‹¤ìŒ ë ˆë²¨ê¹Œì§€ ì§„í–‰ë„(ë°ëª¨)
      const nextNeedMap = { 1: 2, 2: 5, 3: 9, 4: 9 };
      const nextTarget = nextNeedMap[level];
      const progress = level === 4 ? 100 : Math.min(100, Math.round((uploadCount / nextTarget) * 100));

      document.getElementById("passportProgressFill").style.width = progress + "%";

      const remain = level === 4 ? 0 : Math.max(0, nextTarget - uploadCount);
      document.getElementById("passportProgressInfo").textContent =
        level === 4
          ? "ìµœê³  ë ˆë²¨ ë‹¬ì„± (100%)"
          : `${remain}íšŒ ì°¸ì—¬ ë” í•„ìš” (${progress}% ë‹¬ì„±)`;

      // í™ˆ ì¹´ë“œ ì„œë¸Œí…ìŠ¤íŠ¸ë„ ì—…ë°ì´íŠ¸
      const passportHomeSub = document.getElementById("passportHomeSub");
      passportHomeSub.textContent = `í¬ì¸íŠ¸ ${myPoint}P Â· ì¸ì¦ ${uploadCount}íšŒ Â· ${levelTextMap[level]}`;
    }

    // ì´ˆê¸° 1íšŒ
    updateProfileUI();

    // ====== ê´€ë¦¬ì ëª¨ë“œ: ì œëª© 3ë²ˆ ì—°ì† í´ë¦­ ======
    const appTitle = document.getElementById("appTitle");
    const adminCodeModal = document.getElementById("adminCodeModal");
    const closeAdminCode = document.getElementById("closeAdminCode");
    const adminCodeSubmit = document.getElementById("adminCodeSubmit");
    const adminCodeCancel = document.getElementById("adminCodeCancel");
    const adminCodeInput = document.getElementById("adminCodeInput");
    const adminCodeMsg = document.getElementById("adminCodeMsg");

    let titleTapCount = 0;
    let titleTapTimer = null;

    function openAdminCode() {
      adminCodeInput.value = "";
      adminCodeMsg.style.display = "none";
      openModal(adminCodeModal);
      setTimeout(() => adminCodeInput.focus(), 50);
    }

    appTitle.addEventListener("click", () => {
      titleTapCount += 1;

      if (titleTapTimer) clearTimeout(titleTapTimer);
      titleTapTimer = setTimeout(() => {
        titleTapCount = 0;
      }, 700);

      if (titleTapCount >= 3) {
        titleTapCount = 0;
        openAdminCode();
      }
    });

    closeAdminCode.addEventListener("click", () => closeModal(adminCodeModal));
    adminCodeCancel.addEventListener("click", () => closeModal(adminCodeModal));
    adminCodeModal.addEventListener("click", (e) => {
      if (e.target === adminCodeModal) closeModal(adminCodeModal);
    });

    // ê´€ë¦¬ì ì½”ë“œ(ë°ëª¨): 99999
    adminCodeSubmit.addEventListener("click", () => {
      const code = (adminCodeInput.value || "").trim();

      if (code === "99999") {
        closeModal(adminCodeModal);

        document.body.classList.add("isAdmin");
        appTitle.textContent = "ì œì£¼ ì—°ì•ˆ ìœ„í—˜ ì§€ë„ (ê´€ë¦¬ì)";

        openAdminDashboard(); // âœ… ë°ìŠ¤í¬í†± ëŒ€ì‹œë³´ë“œ ì°½ ì—´ê¸°
      } else {
        adminCodeMsg.style.display = "block";
      }
    });

    // ì—”í„°ë¡œë„ í™•ì¸
    adminCodeInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") adminCodeSubmit.click();
    });

    // ===== ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ í•¨ìˆ˜ =====
    function openAdminDashboard() {
      const W = 1920;
      const H = 1200;

      // í™”ë©´ ì¤‘ì•™ì— ëœ¨ê²Œ
      const left = Math.max(0, Math.floor((screen.width - W) / 2));
      const top = Math.max(0, Math.floor((screen.height - H) / 2));

      const win = window.open(
        "",
        "AdminDashboard",
        `width=${W},height=${H},left=${left},top=${top},resizable=yes,scrollbars=yes`
      );

      if (!win) {
        alert("íŒì—…ì´ ì°¨ë‹¨ë˜ì–´ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œë¥¼ ì—´ ìˆ˜ ì—†ì–´ìš”. ë¸Œë¼ìš°ì €ì—ì„œ íŒì—… í—ˆìš© í›„ ë‹¤ì‹œ ì‹œë„í•´ì¤˜!");
        return;
      }

      // ===== ë°ëª¨ ë°ì´í„°(ì›í•˜ë©´ ë„¤ ì‹¤ì œ ë°ì´í„°ë¡œ ì—°ê²°) =====
      const adminPoints = [
        { id: "P1", name: "í˜‘ì¬ í•´ë³€", x: 42, y: 40, risk: "ë³´í†µ", erosion_cm: 12, wave_m: 0.6, crowd: 320, reports: 18 },
        { id: "P2", name: "ì• ì›” í•´ì•ˆ", x: 55, y: 28, risk: "ìš°ë ¤", erosion_cm: 28, wave_m: 0.9, crowd: 510, reports: 32 },
        { id: "P3", name: "ì„±ì‚° ì¼ì¶œë´‰", x: 74, y: 44, risk: "ì‹¬ê°", erosion_cm: 44, wave_m: 1.2, crowd: 880, reports: 61 },
        { id: "P4", name: "ì¤‘ë¬¸ í•´ì•ˆ", x: 52, y: 66, risk: "ë³´í†µ", erosion_cm: 10, wave_m: 0.5, crowd: 260, reports: 9 },
      ];

      // ìƒˆ ì°½ì— HTMLì„ í†µì§¸ë¡œ ì”€
      win.document.open();
      win.document.write(`<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ | ì œì£¼ ì—°ì•ˆ ìœ„í—˜ ì§€ë„</title>
  <style>
    *{box-sizing:border-box;}
    body{
      margin:0;
      font-family: -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", "Segoe UI", Arial, sans-serif;
      background:#f4f5f7;
      color:#111827;
    }

    /* 1920x1200 ë°ìŠ¤í¬í†± ê·œê²© ëŠë‚Œ */
    .wrap{
      width: min(1920px, 100vw);
      height: min(1200px, 100vh);
      margin: 0 auto;
      padding: 18px;
      display:flex;
      flex-direction:column;
      gap: 14px;
    }

    .topbar{
      background:#fff;
      border:1px solid #e5e7eb;
      border-radius: 16px;
      padding: 14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      box-shadow: 0 6px 18px rgba(0,0,0,0.06);
    }
    .topLeft{display:flex; flex-direction:column; gap:3px;}
    .title{font-size:18px; font-weight:900;}
    .sub{font-size:12px; color:#6b7280;}
    .topRight{display:flex; gap:10px; align-items:center;}
    .pill{
      background:#111827;
      color:#fff;
      border:none;
      padding:10px 12px;
      border-radius: 12px;
      font-weight:900;
      cursor:pointer;
      font-size:12px;
    }
    .ghost{
      background:#fff;
      color:#111827;
      border:1px solid #e5e7eb;
      padding:10px 12px;
      border-radius: 12px;
      font-weight:900;
      cursor:pointer;
      font-size:12px;
    }

    /* ë©”ì¸ ê·¸ë¦¬ë“œ: ì¢Œ(ì§€ë„) / ìš°(ìˆ˜ì¹˜) */
    .grid{
      flex:1;
      min-height: 0;
      display:grid;
      grid-template-columns: 1.25fr 1fr;
      gap: 14px;
    }

    .card{
      background:#fff;
      border:1px solid #e5e7eb;
      border-radius: 18px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.06);
      overflow:hidden;
      min-height: 0;
    }

    /* ì¢Œì¸¡ ì§€ë„ ì¹´ë“œ */
    .mapHead{
      padding: 14px 16px;
      border-bottom: 1px solid #e5e7eb;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .mapHead .h{
      font-size:14px; font-weight:900;
    }
    .mapHead .hint{
      font-size:12px; color:#6b7280;
    }

    .mapBody{
      height: calc(100% - 57px);
      padding: 16px;
      background: linear-gradient(180deg, #f9fafb, #f4f5f7);
    }

    .jejuBoard{
      width:100%;
      height:100%;
      border-radius: 16px;
      border: 1px solid #e5e7eb;
      position: relative;
      overflow:hidden;
    }

    .mapImg{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit: cover;
      display:block;
    }

    .pinLayer{
      position:absolute;
      inset:0;
    }

    /* í¬ì¸íŠ¸(í•€) */
    .pin{
      position:absolute;
      width: 14px;
      height: 14px;
      border-radius: 999px;
      border: 2px solid #fff;
      box-shadow: 0 8px 16px rgba(0,0,0,0.18);
      cursor:pointer;
      transform: translate(-50%, -50%);
    }
    .pin[data-risk="ë³´í†µ"]{ background:#22c55e; }
    .pin[data-risk="ìš°ë ¤"]{ background:#a855f7; }
    .pin[data-risk="ì‹¬ê°"]{ background:#ef4444; }

    .legend{
      position:absolute;
      right: 14px;
      bottom: 14px;
      background: rgba(255,255,255,0.92);
      border: 1px solid #e5e7eb;
      border-radius: 14px;
      padding: 10px 12px;
      font-size: 12px;
      backdrop-filter: blur(8px);
    }
    .legend b{display:block; margin-bottom:8px; font-size:12px;}
    .legendRow{display:flex; gap:10px; align-items:center; flex-wrap:wrap;}
    .dot{width:10px; height:10px; border-radius:999px; display:inline-block;}
    .dG{background:#22c55e;}
    .dP{background:#a855f7;}
    .dR{background:#ef4444;}

    /* ìš°ì¸¡ ìˆ˜ì¹˜ ì¹´ë“œ */
    .infoHead{
      padding: 14px 16px;
      border-bottom: 1px solid #e5e7eb;
    }
    .infoHead .h{font-size:14px; font-weight:900;}
    .infoHead .s{font-size:12px; color:#6b7280; margin-top:4px;}

    .infoBody{
      height: calc(100% - 68px);
      overflow:auto;
      padding: 14px;
      display:flex;
      flex-direction:column;
      gap: 12px;
    }

    .block{
      border:1px solid #e5e7eb;
      border-radius: 16px;
      background:#fff;
      padding: 14px;
    }
    .blockTitle{
      font-size:13px;
      font-weight:900;
      margin-bottom: 12px;
    }

    .row{
      display:flex;
      gap: 10px;
      align-items:center;
      justify-content:space-between;
      margin-bottom: 10px;
    }
    .key{font-size:12px; color:#6b7280; font-weight:800;}
    .val{font-size:12px; font-weight:900; color:#111827;}

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .field{
      display:flex;
      flex-direction:column;
      gap: 6px;
    }
    .label{
      font-size:12px;
      color:#6b7280;
      font-weight:900;
    }
    input[type="number"], input[type="text"], select{
      width: 100%;
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      outline:none;
      font-size: 13px;
      font-weight: 900;
      background:#fff;
      color:#111827;
    }

    .saveRow{
      display:flex;
      gap: 10px;
      margin-top: 12px;
    }
    .saveRow button{
      flex:1;
    }

    .table{
      width:100%;
      border-collapse: collapse;
      overflow:hidden;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
    }
    .table th, .table td{
      padding: 10px 10px;
      border-bottom: 1px solid #e5e7eb;
      font-size: 12px;
    }
    .table th{
      text-align:left;
      color:#6b7280;
      font-weight: 900;
      background:#f9fafb;
    }
    .table td{
      font-weight: 800;
      color:#111827;
    }

    /* === ëª¨ë°”ì¼ì—ì„œë„ ê°€ë¡œ(2ì»¬ëŸ¼) ìœ ì§€: ì „ì²´ í™”ë©´ì„ ì¶•ì†Œí•´ì„œ ë„£ê¸° === */
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    body {
      overflow: auto;
    }

    .viewportLock {
      width: 1920px;
      height: 1200px;
      transform-origin: top left;
    }
  </style>
</head>
<body>
  <div id="viewportLock" class="viewportLock">
    <div class="wrap">
    <div class="topbar">
      <div class="topLeft">
        <div class="title">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</div>
        <div class="sub">í•´ì•ˆ ëª¨ë‹ˆí„°ë§ ì§€ì  ê´€ë¦¬ Â· ìˆ˜ì¹˜ ê¸°ë°˜ í¸ì§‘(ìŠ¬ë¼ì´ë” ì—†ìŒ)</div>
      </div>
      <div class="topRight">
        <button class="ghost" id="btnSync">ì•± ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°(ë°ëª¨)</button>
        <button class="pill" id="btnClose">ì°½ ë‹«ê¸°</button>
      </div>
    </div>

    <div class="grid">
      <!-- ì¢Œì¸¡: ì œì£¼ë„ ì§€ë„ -->
      <div class="card">
        <div class="mapHead">
          <div class="h">ì œì£¼ë„ ëª¨ë‹ˆí„°ë§ ë§µ</div>
          <div class="hint">â— ì§€ì ì„ í´ë¦­í•˜ë©´ ìš°ì¸¡ ìˆ˜ì¹˜ íŒ¨ë„ì´ ë°”ë€œ</div>
        </div>

        <div class="mapBody">
          <div class="jejuBoard" id="jejuBoard">
            <img class="mapImg" src="jeju-risk-map.png" alt="Jeju Risk Map" />
            <div class="pinLayer" id="pinLayer"></div>

            <div class="legend">
              <b>ìœ„í—˜ ë“±ê¸‰</b>
              <div class="legendRow">
                <span class="dot dG"></span><span>ë³´í†µ</span>
                <span class="dot dP"></span><span>ìš°ë ¤</span>
                <span class="dot dR"></span><span>ì‹¬ê°</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ìš°ì¸¡: ìˆ˜ì¹˜ íŒ¨ë„(ìŠ¬ë¼ì´ë” X, ìˆ«ì/í‘œ) -->
      <div class="card">
        <div class="infoHead">
          <div class="h">ì„ íƒ ì§€ì  ìˆ˜ì¹˜ í¸ì§‘</div>
          <div class="s">ì˜¤ë¥¸ìª½ì€ "ì‹¤ì œ ìˆ˜ì¹˜" ì…ë ¥/í‘œì‹œ ìœ„ì£¼ (ìŠ¬ë¼ì´ë” ì œê±°)</div>
        </div>

        <div class="infoBody">
          <div class="block">
            <div class="blockTitle">ì„ íƒëœ ì§€ì </div>
            <div class="row">
              <div class="key">ì§€ì ëª…</div>
              <div class="val" id="selName">-</div>
            </div>
            <div class="row">
              <div class="key">ì§€ì  ID</div>
              <div class="val" id="selId">-</div>
            </div>
          </div>

          <div class="block">
            <div class="blockTitle">ìœ„í—˜/ì„¼ì„œ ìˆ˜ì¹˜(í¸ì§‘)</div>

            <div class="grid2">
              <div class="field">
                <div class="label">ìœ„í—˜ ë“±ê¸‰</div>
                <select id="fRisk">
                  <option value="ë³´í†µ">ë³´í†µ</option>
                  <option value="ìš°ë ¤">ìš°ë ¤</option>
                  <option value="ì‹¬ê°">ì‹¬ê°</option>
                </select>
              </div>

              <div class="field">
                <div class="label">ì¹¨ì‹ëŸ‰ (cm)</div>
                <input id="fErosion" type="number" step="1" min="0" />
              </div>

              <div class="field">
                <div class="label">íŒŒê³  (m)</div>
                <input id="fWave" type="number" step="0.1" min="0" />
              </div>

              <div class="field">
                <div class="label">ìµœê·¼ 7ì¼ ë°©ë¬¸ ìˆ˜</div>
                <input id="fCrowd" type="number" step="1" min="0" />
              </div>

              <div class="field">
                <div class="label">ì œë³´(ì¸ì¦) ìˆ˜</div>
                <input id="fReports" type="number" step="1" min="0" />
              </div>

              <div class="field">
                <div class="label">ë¹„ê³ </div>
                <input id="fMemo" type="text" placeholder="ë©”ëª¨(ì„ íƒ)" />
              </div>
            </div>

            <div class="saveRow">
              <button class="ghost" id="btnReset">ë˜ëŒë¦¬ê¸°</button>
              <button class="pill" id="btnSave">ì €ì¥(ë°ëª¨)</button>
            </div>
          </div>

          <div class="block">
            <div class="blockTitle">ìš”ì•½ í…Œì´ë¸”</div>
            <table class="table" id="summaryTable">
              <thead>
                <tr>
                  <th>í•­ëª©</th>
                  <th>ê°’</th>
                </tr>
              </thead>
              <tbody>
                <tr><td>ìœ„í—˜ ë“±ê¸‰</td><td id="tRisk">-</td></tr>
                <tr><td>ì¹¨ì‹ëŸ‰ (cm)</td><td id="tErosion">-</td></tr>
                <tr><td>íŒŒê³  (m)</td><td id="tWave">-</td></tr>
                <tr><td>ìµœê·¼ 7ì¼ ë°©ë¬¸</td><td id="tCrowd">-</td></tr>
                <tr><td>ì œë³´(ì¸ì¦) ìˆ˜</td><td id="tReports">-</td></tr>
              </tbody>
            </table>
          </div>

        </div>
      </div>
    </div>
  </div>

<script>
  const adminPoints = ${JSON.stringify(adminPoints)};

  const board = document.getElementById("jejuBoard");
  const pinLayer = document.getElementById("pinLayer");

  const selName = document.getElementById("selName");
  const selId = document.getElementById("selId");

  const fRisk = document.getElementById("fRisk");
  const fErosion = document.getElementById("fErosion");
  const fWave = document.getElementById("fWave");
  const fCrowd = document.getElementById("fCrowd");
  const fReports = document.getElementById("fReports");
  const fMemo = document.getElementById("fMemo");

  const tRisk = document.getElementById("tRisk");
  const tErosion = document.getElementById("tErosion");
  const tWave = document.getElementById("tWave");
  const tCrowd = document.getElementById("tCrowd");
  const tReports = document.getElementById("tReports");

  let selected = null;
  let original = null;

  function renderPins(){
    // ê¸°ì¡´ í•€ ì œê±°
    [...pinLayer.querySelectorAll(".pin")].forEach(el => el.remove());

    adminPoints.forEach(p => {
      const pin = document.createElement("div");
      pin.className = "pin";
      pin.dataset.id = p.id;
      pin.dataset.risk = p.risk;
      pin.title = p.name + " (" + p.risk + ")";

      // x,yëŠ” % ì¢Œí‘œ(0~100)
      pin.style.left = p.x + "%";
      pin.style.top = p.y + "%";

      pin.addEventListener("click", () => selectPoint(p.id));
      pinLayer.appendChild(pin);
    });
  }

  function fillRightPanel(p){
    selName.textContent = p.name;
    selId.textContent = p.id;

    fRisk.value = p.risk;
    fErosion.value = p.erosion_cm;
    fWave.value = p.wave_m;
    fCrowd.value = p.crowd;
    fReports.value = p.reports;
    fMemo.value = p.memo || "";

    syncTable(p);
  }

  function syncTable(p){
    tRisk.textContent = p.risk;
    tErosion.textContent = String(p.erosion_cm);
    tWave.textContent = String(p.wave_m);
    tCrowd.textContent = String(p.crowd);
    tReports.textContent = String(p.reports);
  }

  function selectPoint(id){
    const p = adminPoints.find(x => x.id === id);
    if(!p) return;

    selected = p;
    // ë˜ëŒë¦¬ê¸°ìš© ë°±ì—…
    original = JSON.parse(JSON.stringify(p));

    fillRightPanel(p);
  }

  function applyEditsToSelected(){
    if(!selected) return;

    selected.risk = fRisk.value;
    selected.erosion_cm = Number(fErosion.value || 0);
    selected.wave_m = Number(fWave.value || 0);
    selected.crowd = Number(fCrowd.value || 0);
    selected.reports = Number(fReports.value || 0);
    selected.memo = (fMemo.value || "").trim();

    syncTable(selected);
    renderPins(); // ìœ„í—˜ë“±ê¸‰ ë°”ë€Œë©´ ìƒ‰ë„ ë°”ë€œ
  }

  // ì…ë ¥ ë³€í™” ì¦‰ì‹œ í…Œì´ë¸” ë°˜ì˜(ì‹¤ìˆ˜ì¹˜ í™•ì¸ìš©)
  [fRisk, fErosion, fWave, fCrowd, fReports, fMemo].forEach(el => {
    el.addEventListener("input", applyEditsToSelected);
  });

  document.getElementById("btnSave").addEventListener("click", () => {
    if(!selected) return alert("ì§€ì ì„ ë¨¼ì € ì„ íƒí•´ ì£¼ì„¸ìš”.");
    applyEditsToSelected();
    alert("âœ… ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤(ë°ëª¨). ì‹¤ì œ ì €ì¥ì€ ì„œë²„/DB ì—°ë™ ì‹œ êµ¬í˜„");
  });

  document.getElementById("btnReset").addEventListener("click", () => {
    if(!selected || !original) return;
    Object.assign(selected, JSON.parse(JSON.stringify(original)));
    fillRightPanel(selected);
    renderPins();
  });

  document.getElementById("btnClose").addEventListener("click", () => window.close());

  document.getElementById("btnSync").addEventListener("click", () => {
    alert("ë°ëª¨: ì•±ì˜ ë¡œì»¬ìŠ¤í† ë¦¬ì§€/ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ëŒì–´ì˜¤ëŠ” ê¸°ëŠ¥ ìë¦¬ì…ë‹ˆë‹¤.");
  });

  renderPins();
  // ì²« ì„ íƒ(ê¸°ë³¸)
  selectPoint(adminPoints[0].id);
<\/script>
    </div>
  </div>

  <script>
    function fit(){
      const baseW = 1920, baseH = 1200;
      const s = Math.min(window.innerWidth / baseW, window.innerHeight / baseH);
      const el = document.getElementById("viewportLock");
      if(el) el.style.transform = "scale(" + s + ")";
    }
    window.addEventListener("resize", fit);
    fit();
  <\/script>
</body>
</html>`);

      win.document.close();
      win.focus();
    }
  </script>
</body>
</html>
